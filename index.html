<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #002f34;
            --secondary-color: #23e5db;
            --accent-color: #ffce32;
            --light-color: #f2f4f5;
            --dark-color: #002f34;
            --success-color: #00a650;
            --warning-color: #ff6b6b;
            --bg-color: #f2f4f5;
            --text-color: #002f34;
            --card-bg: white;
            --input-bg: white;
        }
        /* ===== ENTRANCE ANIMATIONS ===== */
/* Fade-in animation for page load */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
/* Update the shop card styles in search results */
#allShopsContainer .shop-card {
    width: 100%; /* Take full width of column */
    margin-right: 0; /* Remove margin between cards */
    margin-bottom: 15px;
}

/* Ensure the columns have proper spacing */
#allShopsContainer .col-md-4 {
    padding: 0 8px; /* Add some padding between columns */
}

/* Make sure images fill the card width */
#allShopsContainer .shop-img {
    width: 100%;
    height: 180px; /* Fixed height for consistency */
    object-fit: cover;
}

/* Adjust card content padding */
#allShopsContainer .shop-card .p-3 {
    padding: 12px !important;
}
/* Change filter button color to match search button */
#filterBtn {
    color: white; /* Same as search button text */
    background-color: var(--primary-color); /* Same as search button background */
    border-color: rgb(0, 0, 0); /* Same as search button border */
    border: solid 1px rgb(0, 0, 0); /* Same as search button border */
}

/* Hover state to match search button */
#filterBtn:hover {
    background-color: #001a1c; /* Same as search button hover */
    border-color: #001a1c; /* Same as search button hover */
    color: white;
}
body {
    animation: fadeIn 0.5s ease-out forwards;
}

/* Slide-up animation for cards */
@keyframes slideUp {
    from { 
        opacity: 0;
        transform: translateY(20px);
    }
    to { 
        opacity: 1;
        transform: translateY(0);
    }
}

.shop-card, .delivery-card, .category-item, .search-container {
    animation: slideUp 0.4s ease-out forwards;
    animation-delay: calc(var(--order) * 0.1s);
    opacity: 0;
}

/* ===== HOVER ANIMATIONS ===== */
/* Card hover effect */
.shop-card:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}

/* Button hover effect */
.btn-primary:hover, .btn-accent:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transition: all 0.2s ease;
}

/* Category item hover */
.category-item:not(.active):hover {
    transform: translateY(-3px);
    transition: transform 0.2s ease;
}

.category-item:not(.active):hover .category-icon {
    transform: scale(1.1);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

/* ===== INTERACTIVE ANIMATIONS ===== */
/* Pulse animation for notifications */
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.notification-badge {
    animation: pulse 1.5s infinite;
}

/* Add button animation */


/* Favorite button animation */
.favorite-btn {
    transition: all 0.3s ease;
}

.favorite-btn:hover {
    transform: scale(1.2);
}

.favorite-btn.active {
    animation: heartBeat 0.5s;
}

@keyframes heartBeat {
    0% { transform: scale(1); }
    25% { transform: scale(1.3); }
    50% { transform: scale(1); }
    75% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

/* ===== FORM ANIMATIONS ===== */
/* Input focus animation */
.form-control:focus, .form-select:focus {
    transform: scale(1.01);
    transition: transform 0.2s ease;
}

/* Button click animation */
.btn:active {
    transform: translateY(1px);
    transition: transform 0.1s ease;
}

/* ===== LOADING ANIMATIONS ===== */
/* Skeleton loading animation */
@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.skeleton-loader::after {
    animation: shimmer 1.5s infinite;
}

/* Spinner animation */
@keyframes spin {
    to { transform: rotate(360deg); }
}

.spinner {
    animation: spin 1s linear infinite;
}

/* Loading dots animation */
@keyframes loadingPulse {
    0%, 100% { transform: scale(0.8); opacity: 0.5; }
    50% { transform: scale(1.2); opacity: 1; }
}

.loading-dot {
    animation: loadingPulse 1.5s infinite ease-in-out;
}

/* ===== MODAL ANIMATIONS ===== */
/* Modal entrance animation */
.modal.fade .modal-dialog {
    transform: translateY(-20px);
    transition: all 0.3s ease-out;
}

.modal.show .modal-dialog {
    transform: translateY(0);
}

/* ===== NAVIGATION ANIMATIONS ===== */
/* Bottom nav item animation */
.bottom-nav-item {
    transition: all 0.3s ease;
}

.bottom-nav-item:not(.active):hover {
    transform: translateY(-3px);
}

/* ===== PANEL ANIMATIONS ===== */
/* Search/support panel animation */
.search-panel, .support-panel, .favorite-panel {
    transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

/* ===== TOGGLE ANIMATIONS ===== */
/* Theme toggle animation */
.theme-toggle-slider {
    transition: .4s;
}

.theme-toggle-slider:before {
    transition: .4s;
}

/* ===== UTILITY ANIMATIONS ===== */
/* Bounce animation for attention */
@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
}

.bounce {
    animation: bounce 1s;
}

/* Fade-in-up for alerts */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.alert {
    animation: fadeInUp 0.3s ease-out;
}

/* ===== DELAYED ANIMATIONS ===== */
/* Stagger animations for list items */
.category-item:nth-child(1) { --order: 1; }
.category-item:nth-child(2) { --order: 2; }
.category-item:nth-child(3) { --order: 3; }
.category-item:nth-child(4) { --order: 4; }
.category-item:nth-child(5) { --order: 5; }
.category-item:nth-child(6) { --order: 6; }
.category-item:nth-child(7) { --order: 7; }
.category-item:nth-child(8) { --order: 8; }
.category-item:nth-child(9) { --order: 9; }

.shop-card:nth-child(1) { --order: 1; }
.shop-card:nth-child(2) { --order: 2; }
.shop-card:nth-child(3) { --order: 3; }
.shop-card:nth-child(4) { --order: 4; }
.shop-card:nth-child(5) { --order: 5; }
.shop-card:nth-child(6) { --order: 6; }

        /* Dark mode variables */
        .dark-mode {
            --primary-color: #23e5db;
            --secondary-color: #002f34;
            --accent-color: #ffce32;
            --light-color: #121212;
            --dark-color: #f2f4f5;
            --bg-color: #121212;
            --text-color: #f2f4f5;
            --card-bg: #1e1e1e;
            --input-bg: #2d2d2d;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding-bottom: 70px; /* Space for bottom navigation */
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
        }

        /* Loading screen styles - Dubizzle/OLX style */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-logo {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
        }

        .loading-logo i {
            margin-right: 10px;
        }

        .loading-dots {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .loading-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--primary-color);
            animation: loadingPulse 1.5s infinite ease-in-out;
        }

        .loading-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .loading-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .loading-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes loadingPulse {
            0%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
        }

        /* Loading skeleton styles - Dubizzle style */
        .skeleton-loader {
            position: relative;
            overflow: hidden;
            background-color: var(--card-bg);
            border-radius: 8px;
        }

        .skeleton-loader::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                rgba(255,255,255,0) 0%, 
                rgba(255,255,255,0.3) 50%, 
                rgba(255,255,255,0) 100%);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        .skeleton-card {
            height: 300px;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .skeleton-text {
            height: 15px;
            width: 80%;
            margin-bottom: 10px;
            border-radius: 4px;
            background-color: var(--light-color);
        }

        .skeleton-text.short {
            width: 50%;
        }

        .skeleton-image {
            height: 150px;
            width: 100%;
            background-color: var(--light-color);
            border-radius: 8px 8px 0 0;
        }

        .skeleton-content {
            padding: 15px;
        }

        /* Main content styles */
        .navbar {
            background-color: var(--primary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            font-weight: 700;
            color: white !important;
        }

        .search-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 15px;
        }

        .shop-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            margin-bottom: 15px;
            overflow: hidden;
            border: none;
            cursor: pointer;
            color: var(--text-color);
            position: relative;
            flex: 0 0 auto;
            width: 200px;
            margin-right: 15px;
        }

        .shop-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .shop-card.premium {
            border-left: 4px solid var(--accent-color);
        }

        .shop-img {
            height: 150px;
            object-fit: cover;
            width: 100%;
        }

        .category-item.active {
            color: var(--primary-color);
        }

        .category-item.active .category-icon {
            background-color: var(--primary-color);
            color: white;
        }

        .premium-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--accent-color);
            color: var(--dark-color);
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .delivery-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--success-color);
            color: white;
            padding: 3px 5px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 15px 0;
            color: var(--text-color);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: #001a1c;
            border-color: #001a1c;
        }

        .btn-accent {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            color: var(--dark-color);
        }

        .btn-accent:hover {
            background-color: #e6b82e;
            border-color: #e6b82e;
            color: var(--dark-color);
        }

        .form-control, .form-select {
            background-color: var(--input-bg);
            color: var(--text-color);
            border-color: var(--text-color);
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 0.25rem rgba(255, 206, 50, 0.25);
            background-color: var(--input-bg);
            color: var(--text-color);
        }

        /* Bottom navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            padding: 10px 0;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-color);
            font-size: 0.8rem;
        }

        .bottom-nav-item i {
            font-size: 1.2rem;
            margin-bottom: 3px;
        }

        .bottom-nav-item.active {
            color: var(--primary-color);
        }

        .add-btn {
            background-color: var(--accent-color);
            color: var(--dark-color);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            border: none;
        }

        /* Premium shops carousel */
        .premium-carousel {
            margin-bottom: 20px;
        }

        .premium-carousel .carousel-item {
            padding: 0 10px;
            transition: transform 0.5s ease-in-out;
        }

        .carousel-control-prev, .carousel-control-next {
            width: 30px;
        }

        /* Categories */
        .categories {
            display: flex;
            overflow-x: auto;
            padding: 5px 0;
            margin-bottom: 15px;
            -webkit-overflow-scrolling: touch;
        }

        .categories::-webkit-scrollbar {
            display: none;
        }

        .category-item {
            flex: 0 0 auto;
            margin-right: 10px;
            text-align: center;
            text-decoration: none;
            color: var(--text-color);
        }

        .category-icon {
            width: 50px;
            height: 50px;
            background-color: var(--card-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .category-name {
            font-size: 0.8rem;
            white-space: nowrap;
        }

        /* Request form */
        .request-form {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Delivery section */
        .delivery-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .delivery-info {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .delivery-info i {
            margin-right: 10px;
            color: var(--primary-color);
        }

        /* Premium carousel single item */
        .premium-carousel-item {
            padding: 0 5px;
        }

        /* Category shops slider */
        .category-shops {
            margin-bottom: 30px;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .view-all-btn {
            color: var(--primary-color);
            font-size: 0.9rem;
            text-decoration: none;
        }

        .shops-slider {
            display: flex;
            overflow-x: auto;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 10px;
        }

        .shops-slider::-webkit-scrollbar {
            display: none;
        }

        /* Small screens adjustments */
        @media (max-width: 768px) {
            .shop-img {
                height: 150px;
            }
            
            .section-title {
                font-size: 1.1rem;
            }
            
            .premium-carousel-item {
                padding: 0 2px;
            }
            
            .premium-badge, .delivery-badge {
                font-size: 0.7rem;
                padding: 2px 5px;
            }
            
            .premium-badge {
                top: 5px;
                left: 5px;
            }
            
            .delivery-badge {
                top: 5px;
                right: 5px;
            }

            .shop-card {
                width: 160px;
                margin-right: 10px;
            }
        }

        /* Login/Signup form */
        .auth-form {
            max-width: 400px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .auth-form .form-control {
            margin-bottom: 15px;
        }

        /* Account info */
        .account-info {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        /* Support form */
        .support-form {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        /* Messages list */
        .messages-list {
            margin-top: 20px;
        }

        .message-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .message-sender {
            font-weight: bold;
        }

        .message-date {
            color: var(--text-color);
            opacity: 0.7;
            font-size: 0.9rem;
        }

        .message-content {
            margin-bottom: 10px;
        }

        .message-reply {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--text-color);
            opacity: 0.2;
        }

        /* WhatsApp button */
        .whatsapp-btn {
            background-color: #25D366;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }

        .whatsapp-btn i {
            margin-right: 5px;
        }

        .whatsapp-btn:hover {
            background-color: #128C7E;
            color: white;
        }

        /* Notification badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: red;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Theme toggle */
        .theme-toggle {
            cursor: pointer;
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .theme-toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-right: 10px;
        }

        .theme-toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .theme-toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .theme-toggle-slider {
            background-color: var(--primary-color);
        }

        input:checked + .theme-toggle-slider:before {
            transform: translateX(26px);
        }

        /* Add options menu */
        .add-options-menu {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            padding: 10px;
            z-index: 1050;
            display: none;
        }

        .add-option-btn {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            border-radius: 5px;
            margin-bottom: 5px;
            text-decoration: none;
            color: var(--text-color);
        }

        .add-option-btn:hover {
            background-color: rgba(0,0,0,0.1);
        }

        .add-option-btn i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .add-options-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 1040;
            display: none;
        }

        /* Expire date badge */
        .expire-badge {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: var(--warning-color);
            color: white;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Loading spinner */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Search panel */
        .search-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 1100;
            padding: 20px;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

        .search-panel.active {
            transform: translateY(0);
        }

        .search-panel-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .search-panel-back {
            margin-right: 15px;
            font-size: 1.5rem;
            color: var(--text-color);
        }

        .recent-searches {
            margin-top: 20px;
        }

        .search-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .search-item-remove {
            color: var(--warning-color);
            cursor: pointer;
        }

        /* Favorite button */
        .favorite-btn {
            position: absolute;
            bottom: 60px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1;
        }

        .favorite-btn.active {
            color: red;
        }

        /* Back button */
        .back-button {
            display: inline-flex;
            align-items: center;
            margin-bottom: 15px;
            color: var(--primary-color);
            cursor: pointer;
        }

        /* Language switcher */
        .language-switcher {
            display: flex;
            margin-bottom: 15px;
        }

        .language-btn {
            padding: 5px 10px;
            border: 1px solid var(--primary-color);
            background-color: transparent;
            color: var(--primary-color);
            margin-right: 10px;
            border-radius: 4px;
        }

        .language-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* Support panel */
        .support-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 1100;
            padding: 20px;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

        .support-panel.active {
            transform: translateY(0);
        }

        .support-panel-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .support-panel-back {
            margin-right: 15px;
            font-size: 1.5rem;
            color: var(--text-color);
        }

        /* Favorite shops section */
        .favorite-shops-section {
            margin-top: 20px;
        }

        .favorite-tab {
            padding: 10px;
            border-bottom: 2px solid transparent;
            cursor: pointer;
        }

        .favorite-tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        /* Search filters */
        .search-filters {
            margin-top: 15px;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Favorite panel */
        .favorite-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 1100;
            padding: 20px;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

        .favorite-panel.active {
            transform: translateY(0);
        }

        .favorite-panel-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .favorite-panel-back {
            margin-right: 15px;
            font-size: 1.5rem;
            color: var(--text-color);
        }

        /* Login button in navbar */
        .login-btn {
            background-color: var(--accent-color);
            color: var(--dark-color);
            border: none;
            border-radius: 20px;
            padding: 5px 15px;
            font-weight: 500;
        }

        .pagination-loader {
            display: none;
            text-align: center;
            padding: 15px;
        }

        .pagination-loader .d-flex {
            gap: 10px;
        }

        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin: 0;
        }

        /* Optimized image loading */
        .lazy-img {
            background-color: #f0f0f0;
            background-size: cover;
            background-position: center;
        }
.featured-shops-slider {
    position: relative;
    margin-bottom: 20px;
    overflow: hidden;
    touch-action: pan-y;
    width: 100%;
    border-radius: 8px;
}

.featured-shops-container {
    display: flex;
    transition: transform 0.3s ease-out;
    will-change: transform;
    height: 250px; /* Fixed height for all featured items */
}

.featured-shop-card {
    flex: 0 0 100%;
    min-width: 100%;
    height: 100%;
    position: relative;
    user-select: none;
}

.featured-shop-card .shop-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
}

.slider-dots {
    display: none;
    justify-content: center;
    margin-top: 10px;
    gap: 8px;
    margin-bottom: 5px;
}

.slider-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: var(--light-color);
    cursor: pointer;
    transition: all 0.3s ease;
}

.slider-dot.active {
    background-color: var(--primary-color);
    transform: scale(1.2);
}

.featured-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background-color: var(--accent-color);
    color: var(--dark-color);
    padding: 3px 10px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
    z-index: 2;
}
.filter-panel {
    position: relative;
    z-index: 1000;
    width: 100%;
   
    
}

.filter-panel .card {
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

/* Touch scrolling improvements */
.featured-shops-container {
    -webkit-overflow-scrolling: touch;
    scroll-snap-type: x mandatory;
}

.featured-shop-card {
    scroll-snap-align: start;
}

@media (min-width: 768px) {
    .featured-shops-slider {
        height: 300px; /* Taller on larger screens */
    }
}
.featured-shop-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
    color: white;
    padding: 20px 15px 15px;
    border-radius: 0 0 8px 8px;
}

.featured-shop-overlay h5 {
    font-size: 1.2rem;
    margin-bottom: 5px;
    font-weight: 600;
}

.featured-shop-overlay p {
    font-size: 0.9rem;
    margin: 0;
    opacity: 0.9;
}
.featured-shops-container {
    display: flex;
    transition: transform 0.5s ease;
    width: 100%;
}

.featured-shop-card {
    flex: 0 0 100%;
    width: 100%;
    /* other styles */
}
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">
            <i class="fas fa-store"></i>
            <span>Shop Management</span>
        </div>
        <div class="loading-dots">
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark mb-3">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-store me-2"></i>Shop Management
            </a>
            <div class="d-flex align-items-center">
                <div id="authButtons" class="me-2">
                    <!-- Login/Signup buttons will be added here dynamically -->
                </div>
                <div class="dropdown">
                    <button class="btn btn-light rounded-pill dropdown-toggle position-relative" type="button" id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-ellipsis-v"></i>
                        <span id="notificationBadge" class="notification-badge" style="display: none;"></span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton2">
                        <li><a class="dropdown-item" href="#" id="ownerAccessBtn"><i class="fas fa-user-shield me-2"></i>Shop Owner Access</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item position-relative" href="#" id="notificationsBtn">
                                <i class="fas fa-bell me-2"></i>Notifications
                                <span id="notificationBadgeMenu" class="notification-badge" style="display: none;"></span>
                            </a>
                        </li>
                        <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Status Message -->
        <div id="statusMessage"></div>

        <!-- Account Info Section (shown when account tab is active) -->
        <div class="account-info" id="accountInfo" style="display: none;">
            <h5><i class="fas fa-user-circle me-2"></i>My Account</h5>
            <div id="accountNotLoggedIn" style="display: none;">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>Please login to view account details
                </div>
                <button class="btn btn-primary w-100 mt-3" id="loginAccountBtn">
                    <i class="fas fa-sign-in-alt me-2"></i>Login
                </button>
            </div>
            <div id="accountLoggedIn" style="display: none;">
                <div class="mb-3">
                    <div class="fw-bold">Name:</div>
                    <div id="accountName"></div>
                </div>
                <div class="mb-3">
                    <div class="fw-bold">Email:</div>
                    <div id="accountEmail"></div>
                </div>
                <div class="mb-3">
                    <div class="fw-bold">Joined Date:</div>
                    <div id="accountJoinedDate"></div>
                </div>
                <div class="mb-3">
                    <div class="fw-bold">Account Type:</div>
                    <div id="accountType"></div>
                </div>
                
                <!-- Shop Owner Info -->
                <div id="shopOwnerInfo" style="display: none;">
                    <div class="mb-3">
                        <div class="fw-bold">Shop Name:</div>
                        <div id="shopNameDisplay"></div>
                    </div>
                    <div class="mb-3">
                        <div class="fw-bold">Shop Expiry Date:</div>
                        <div id="shopExpiryDate"></div>
                    </div>
                </div>
                
                <!-- Language Switcher -->
                <div class="language-switcher mb-3">
                    <button class="language-btn active" id="englishBtn">English</button>
                    <button class="language-btn" id="arabicBtn">العربية</button>
                </div>
                
                <!-- Theme Toggle -->
                <div class="theme-toggle mb-3">
                    <label class="theme-toggle-switch">
                        <input type="checkbox" id="themeToggle">
                        <span class="theme-toggle-slider"></span>
                    </label>
                    <span id="themeLabel">Dark Mode</span>
                </div>
                
                <!-- Favorite Shops Button -->
                <button class="btn btn-primary w-100 mb-3" id="favoriteShopsBtn">
                    <i class="fas fa-heart me-2"></i>Favorite Shops
                </button>
                
                <!-- Support Button -->
                <button class="btn btn-primary w-100 mb-3" id="supportBtn">
                    <i class="fas fa-headset me-2"></i>Customer Support
                </button>
                
                <!-- Logout Button -->
                <button class="btn btn-outline-danger w-100" id="logoutAccountBtn">
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                </button>
            </div>
        </div>

        <!-- Main Content Sections (shown when home or delivery tabs are active) -->
        <div id="mainContent">
            <!-- Search Section -->
          <div class="search-container">
    <div class="row g-2 align-items-center">
        <div class="col">
            <div class="input-group">
                <input type="text" class="form-control" id="searchInput" placeholder="Search for shops" readonly>
                <button class="btn btn-primary" id="searchBtn">
                    <i class="fas fa-search"></i>
                </button>
                <button class="btn btn-secondary" id="filterBtn">
                    <i class="fas fa-filter"></i>
                </button>
            </div>
        </div>
    </div>
</div>
<div class="filter-panel" id="shopFilterPanel" style="display: none;">
    <div class="card mt-2">
        <div class="card-body">
            <h6>Filter by Location</h6>
            <select class="form-select mb-2" id="shopLocationFilter">
                <option value="">All Locations</option>
                <option value="Beirut">Beirut</option>
                <option value="Tripoli">Tripoli</option>
                <option value="Sidon">Sidon</option>
                <option value="Tyre">Tyre</option>
                <option value="Byblos">Byblos</option>
                <option value="Zahle">Zahle</option>
                <option value="Baalbek">Baalbek</option>
            </select>
            <button class="btn btn-primary w-100" id="applyShopFilter">Apply Filter</button>
        </div>
    </div>
</div>

<!-- Filter panel for deliveries (from-to) -->
<div class="filter-panel" id="deliveryFilterPanel" style="display: none;">
    <div class="card mt-2">
        <div class="card-body">
            <h6>Filter Deliveries</h6>
            <div class="mb-3">
                <label class="form-label">From</label>
                <select class="form-select mb-2" id="deliveryFromFilter">
                    <option value="">Any Location</option>
                    <option value="Beirut">Beirut</option>
                    <option value="Tripoli">Tripoli</option>
                    <option value="Sidon">Sidon</option>
                    <option value="Tyre">Tyre</option>
                    <option value="Byblos">Byblos</option>
                    <option value="Zahle">Zahle</option>
                    <option value="Baalbek">Baalbek</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">To</label>
                <select class="form-select mb-2" id="deliveryToFilter">
                    <option value="">Any Location</option>
                    <option value="Beirut">Beirut</option>
                    <option value="Tripoli">Tripoli</option>
                    <option value="Sidon">Sidon</option>
                    <option value="Tyre">Tyre</option>
                    <option value="Byblos">Byblos</option>
                    <option value="Zahle">Zahle</option>
                    <option value="Baalbek">Baalbek</option>
                </select>
            </div>
            <button class="btn btn-primary w-100" id="applyDeliveryFilter">Apply Filter</button>
        </div>
    </div>
</div>


            <!-- Back button for category view -->
            <div id="backButtonContainer" style="display: none;">
                <div class="back-button" id="backToMainBtn">
                    <i class="fas fa-arrow-left me-2"></i> Back to all categories
                </div>
            </div>

        

            <!-- Categories Section (shown only on home tab) -->
            <div id="categoriesSection">
                <h6 class="section-title">Explore Categories</h6>
                <div class="categories">
                    <a href="category.html?cat=restaurant" class="category-item" data-category="Restaurant">
                        <div class="category-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="category-name">Restaurants</div>
                    </a>
                    <a href="category.html?cat=grocery" class="category-item" data-category="Grocery">
                        <div class="category-icon">
                            <i class="fas fa-shopping-basket"></i>
                        </div>
                        <div class="category-name">Groceries</div>
                    </a>
                    <a href="category.html?cat=pharmacy" class="category-item" data-category="Pharmacy">
                        <div class="category-icon">
                            <i class="fas fa-pills"></i>
                        </div>
                        <div class="category-name">Pharmacies</div>
                    </a>
                    <a href="category.html?cat=electronics" class="category-item" data-category="Electronics">
                        <div class="category-icon">
                            <i class="fas fa-laptop"></i>
                        </div>
                        <div class="category-name">Electronics</div>
                    </a>
                    <a href="category.html?cat=clothing" class="category-item" data-category="Clothing">
                        <div class="category-icon">
                            <i class="fas fa-tshirt"></i>
                        </div>
                        <div class="category-name">Clothing</div>
                    </a>
                    <a href="category.html?cat=furniture" class="category-item" data-category="Furniture">
                        <div class="category-icon">
                            <i class="fas fa-couch"></i>
                        </div>
                        <div class="category-name">Furniture</div>
                    </a>
                    <a href="category.html?cat=automotive" class="category-item" data-category="Automotive">
                        <div class="category-icon">
                            <i class="fas fa-car"></i>
                        </div>
                        <div class="category-name">Automotive</div>
                    </a>
                    <a href="category.html?cat=beauty" class="category-item" data-category="Beauty">
                        <div class="category-icon">
                            <i class="fas fa-spa"></i>
                        </div>
                        <div class="category-name">Beauty</div>
                    </a>
                    <a href="category.html?cat=other" class="category-item" data-category="Other">
                        <div class="category-icon">
                            <i class="fas fa-ellipsis-h"></i>
                        </div>
                        <div class="category-name">Other</div>
                    </a>
                </div>
            </div>
                <!-- Featured Shops Slider -->
                <div id="featuredShopsSection">
                    <h6 class="section-title">Featured Shops</h6>
                    <div class="featured-shops-slider">
                        <div class="featured-shops-container" id="featuredShopsContainer">
                            <!-- Featured shops will be loaded here -->
                            <div class="featured-shop-card">
                                <div class="skeleton-loader skeleton-card">
                                    <div class="skeleton-image" style="height: 200px;"></div>
                                    <div class="skeleton-content">
                                        <div class="skeleton-text"></div>
                                        <div class="skeleton-text short"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="featured-shop-card">
                                <div class="skeleton-loader skeleton-card">
                                    <div class="skeleton-image" style="height: 200px;"></div>
                                    <div class="skeleton-content">
                                        <div class="skeleton-text"></div>
                                        <div class="skeleton-text short"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="featured-shop-card">
                                <div class="skeleton-loader skeleton-card">
                                    <div class="skeleton-image" style="height: 200px;"></div>
                                    <div class="skeleton-content">
                                        <div class="skeleton-text"></div>
                                        <div class="skeleton-text short"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="slider-dots" id="sliderDots">
                            <!-- Dots will be added dynamically -->
                        </div>
                    </div>
                </div>

            <!-- Category Shops Sections -->
            <div id="categoryShopsContainer">
                <!-- Category shops will be loaded here -->
            </div>

            <!-- All Shops Section -->
            <div id="shopsSection" style="display: none;">
                <h6 class="section-title">All Shops</h6>
                <div class="row g-3" id="allShopsContainer">
                    <!-- Skeleton loader for shops -->
                    <div class="col-md-4 col-6">
                        <div class="skeleton-loader skeleton-card">
                            <div class="skeleton-image"></div>
                            <div class="skeleton-content">
                                <div class="skeleton-text"></div>
                                <div class="skeleton-text short"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-6">
                        <div class="skeleton-loader skeleton-card">
                            <div class="skeleton-image"></div>
                            <div class="skeleton-content">
                                <div class="skeleton-text"></div>
                                <div class="skeleton-text short"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-6">
                        <div class="skeleton-loader skeleton-card">
                            <div class="skeleton-image"></div>
                            <div class="skeleton-content">
                                <div class="skeleton-text"></div>
                                <div class="skeleton-text short"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-6">
                        <div class="skeleton-loader skeleton-card">
                            <div class="skeleton-image"></div>
                            <div class="skeleton-content">
                                <div class="skeleton-text"></div>
                                <div class="skeleton-text short"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-6">
                        <div class="skeleton-loader skeleton-card">
                            <div class="skeleton-image"></div>
                            <div class="skeleton-content">
                                <div class="skeleton-text"></div>
                                <div class="skeleton-text short"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-6">
                        <div class="skeleton-loader skeleton-card">
                            <div class="skeleton-image"></div>
                            <div class="skeleton-content">
                                <div class="skeleton-text"></div>
                                <div class="skeleton-text short"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="shopsLoader" class="pagination-loader">
                    <div class="d-flex align-items-center justify-content-center">
                        <div class="spinner me-2"></div>
                        <div>Loading more shops...</div>
                    </div>
                </div>
            </div>

            <!-- Delivery Section -->
            <div id="deliverySection" style="display: none;">
                <h6 class="section-title">Delivery Services</h6>
                <div class="row g-3" id="deliveryContainer">
                    <!-- Skeleton loader for deliveries -->
                    <div class="col-md-6">
                        <div class="skeleton-loader skeleton-card">
                            <div class="skeleton-image"></div>
                            <div class="skeleton-content">
                                <div class="skeleton-text"></div>
                                <div class="skeleton-text short"></div>
                                <div class="skeleton-text short"></div>
                                <div class="skeleton-text short"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="skeleton-loader skeleton-card">
                            <div class="skeleton-image"></div>
                            <div class="skeleton-content">
                                <div class="skeleton-text"></div>
                                <div class="skeleton-text short"></div>
                                <div class="skeleton-text short"></div>
                                <div class="skeleton-text short"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Panel -->
        <div class="search-panel" id="searchPanel">
            <div class="search-panel-header">
                <div class="search-panel-back" id="searchPanelBackBtn">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <h5>Search</h5>
            </div>
            <div class="input-group mb-3">
                <input type="text" class="form-control" id="searchPanelInput" placeholder="Search for shops or deliveries">
                <button class="btn btn-primary" id="searchPanelBtn">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            
      <!-- In the search-panel div, update the search-filters section -->

            
            <div class="recent-searches">
                <h6>Recent Searches</h6>
                <div id="recentSearchesContainer">
                    <!-- Recent searches will be added here -->
                </div>
            </div>
            
            <!-- Back to main button -->
            <div class="back-to-main-btn" id="searchBackToMainBtn" style="display: none;">
                <i class="fas fa-arrow-left me-2"></i> Back to main page
            </div>
        </div>
        <!-- Filter panel for shops (location only) -->

        <!-- Support Panel -->
        <div class="support-panel" id="supportPanel">
            <div class="support-panel-header">
                <div class="support-panel-back" id="supportPanelBackBtn">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <h5>Customer Support</h5>
            </div>
            <form id="supportForm">
                <div class="mb-3">
                    <label for="supportSubject" class="form-label">Subject</label>
                    <input type="text" class="form-control" id="supportSubject" required>
                </div>
                <div class="mb-3">
                    <label for="supportMessage" class="form-label">Message</label>
                    <textarea class="form-control" id="supportMessage" rows="4" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-paper-plane me-2"></i>Send Message
                </button>
            </form>
            
            <div class="messages-list" id="messagesList">
                <h5 class="mt-4"><i class="fas fa-envelope me-2"></i>Your Messages</h5>
                <div class="alert alert-info">
                    <i class="fas fa-spinner fa-spin me-2"></i>Loading your messages...
                </div>
            </div>
        </div>

        <!-- Favorite Shops Panel -->
        <div class="favorite-panel" id="favoritePanel">
            <div class="favorite-panel-header">
                <div class="favorite-panel-back" id="favoritePanelBackBtn">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <h5>Favorite Shops</h5>
            </div>
            <div id="favoriteShopsPanelContainer">
                <div class="alert alert-info">
                    <i class="fas fa-spinner fa-spin me-2"></i>Loading your favorite shops...
                </div>
            </div>
        </div>

        <!-- Owner Access Modal -->
        <div class="modal fade" id="ownerAccessModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-user-shield me-2"></i>Shop Owner Access</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="ownerUsername" placeholder="Username">
                            <label for="ownerUsername"><i class="fas fa-user me-2"></i>Username</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="ownerCode" placeholder="Owner Code">
                            <label for="ownerCode"><i class="fas fa-key me-2"></i>Enter Your Shop Code</label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="submitOwnerCode">Submit</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Request Shop Modal -->
        <div class="modal fade" id="requestShopModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-store me-2"></i>Request Your Shop</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="requestShopForm">
                            <div class="mb-3">
                                <label for="requesterName" class="form-label">Your Name</label>
                                <input type="text" class="form-control" id="requesterName" required>
                            </div>
                            <div class="mb-3">
                                <label for="requesterPhone" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="requesterPhone" required>
                            </div>
                            <div class="mb-3">
                                <label for="requesterLocation" class="form-label">Shop Location</label>
                                <select class="form-select" id="requesterLocation" required>
                                    <option value="Beirut">Beirut</option>
                                    <option value="Tripoli">Tripoli</option>
                                    <option value="Sidon">Sidon</option>
                                    <option value="Tyre">Tyre</option>
                                    <option value="Byblos">Byblos</option>
                                    <option value="Zahle">Zahle</option>
                                    <option value="Baalbek">Baalbek</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="requesterCategory" class="form-label">Shop Category</label>
                                <select class="form-select" id="requesterCategory">
                                    <option value="Restaurant">Restaurant</option>
                                    <option value="Grocery">Grocery</option>
                                    <option value="Pharmacy">Pharmacy</option>
                                    <option value="Electronics">Electronics</option>
                                    <option value="Clothing">Clothing</option>
                                    <option value="Furniture">Furniture</option>
                                    <option value="Automotive">Automotive</option>
                                    <option value="Beauty">Beauty & Cosmetics</option>
                                    <option value="Books">Books & Stationery</option>
                                    <option value="Sports">Sports & Outdoors</option>
                                    <option value="Toys">Toys & Games</option>
                                    <option value="Jewelry">Jewelry</option>
                                    <option value="Other">Other</option>
                                </select>
                                <div class="form-text">If your category isn't listed, please specify below</div>
                            </div>
                            <div class="mb-3" id="customCategoryContainer" style="display: none;">
                                <label for="customCategory" class="form-label">Custom Category</label>
                                <input type="text" class="form-control" id="customCategory">
                            </div>
                            <button type="submit" class="btn btn-accent w-100">
                                <i class="fas fa-paper-plane me-2"></i>Submit Request
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Request Delivery Modal -->
        <div class="modal fade" id="requestDeliveryModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-truck me-2"></i>Request Delivery Service</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="requestDeliveryForm">
                            <div class="mb-3">
                                <label for="deliveryName" class="form-label">Your Name</label>
                                <input type="text" class="form-control" id="deliveryName" required>
                            </div>
                            <div class="mb-3">
                                <label for="deliveryPhone" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="deliveryPhone" required>
                            </div>
                            <div class="mb-3">
                                <label for="deliveryFrom" class="form-label">Delivery From</label>
                                <select class="form-select" id="deliveryFrom" required>
                                    <option value="Beirut">Beirut</option>
                                    <option value="Tripoli">Tripoli</option>
                                    <option value="Sidon">Sidon</option>
                                    <option value="Tyre">Tyre</option>
                                    <option value="Byblos">Byblos</option>
                                    <option value="Zahle">Zahle</option>
                                    <option value="Baalbek">Baalbek</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="deliveryTo" class="form-label">Delivery To</label>
                                <select class="form-select" id="deliveryTo" required>
                                    <option value="Beirut">Beirut</option>
                                    <option value="Tripoli">Tripoli</option>
                                    <option value="Sidon">Sidon</option>
                                    <option value="Tyre">Tyre</option>
                                    <option value="Byblos">Byblos</option>
                                    <option value="Zahle">Zahle</option>
                                    <option value="Baalbek">Baalbek</option>
                                </select>
                            </div>
                          <!-- In the requestDeliveryModal form -->
<div class="mb-3">
    <label for="deliveryHours" class="form-label">Operating Hours</label>
    <input type="text" class="form-control" id="deliveryHours" placeholder="e.g., 9AM-5PM" required>
</div>
<div class="mb-3">
    <label for="deliveryPrice" class="form-label">Price ($)</label>
    <input type="number" class="form-control" id="deliveryPrice" placeholder="e.g., 10000">
</div>
                            <button type="submit" class="btn btn-accent w-100">
                                <i class="fas fa-paper-plane me-2"></i>Submit Request
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notifications Modal -->
        <div class="modal fade" id="notificationsModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-bell me-2"></i>Notifications</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="notificationsModalBody">
                        <div class="text-center py-3"><i class="fas fa-spinner fa-spin me-2"></i>Loading notifications...</div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="markAllAsReadBtn">Mark All as Read</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Required Modal -->
        <div class="modal fade" id="loginRequiredModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i>Login Required</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>You need to login to access this feature.</p>
                        <p>Please login or create an account to continue.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="goToLoginBtn">Go to Login</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="container">
            <div class="row position-relative">
                <div class="col">
                    <a href="#" class="bottom-nav-item active" id="homeBtn">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#" class="bottom-nav-item" id="myShopBtn">
                        <i class="fas fa-store"></i>
                        <span>My Shop</span>
                    </a>
                </div>
                <div class="col">
                    <button class="add-btn" id="addBtn">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="col">
                    <a href="#" class="bottom-nav-item" id="deliveryBtn">
                        <i class="fas fa-truck"></i>
                        <span>Delivery</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#" class="bottom-nav-item" id="accountBtn">
                        <i class="fas fa-user"></i>
                        <span>Account</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Options Menu -->
    <div class="add-options-menu" id="addOptionsMenu">
        <a href="#" class="add-option-btn" id="addShopOption">
            <i class="fas fa-store"></i> Add Shop Request
        </a>
        <a href="#" class="add-option-btn" id="addDeliveryOption">
            <i class="fas fa-truck"></i> Add Delivery Request
        </a>
        <a href="#" class="add-option-btn" id="accessShopOption">
            <i class="fas fa-key"></i> Access My Shop
        </a>
    </div>
    <div class="add-options-backdrop" id="addOptionsBackdrop"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script>
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC87bXSNeIQ3Cno4wQAO4COy9fx_VZRNY4",
            authDomain: "my-free-storage-test.firebaseapp.com",
            databaseURL: "https://my-free-storage-test-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "my-free-storage-test",
            storageBucket: "my-free-storage-test.firebasestorage.app",
            messagingSenderId: "804356355407",
            appId: "1:804356355407:web:e29bc41cc36d92712cc13a",
            measurementId: "G-G7EP7DZEKS"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Enable offline persistence (reduces reads and improves performance)
        db.enablePersistence()
            .catch((err) => {
                if (err.code == 'failed-precondition') {
                    console.log("Offline persistence can only be enabled in one tab at a time.");
                } else if (err.code == 'unimplemented') {
                    console.log("The current browser does not support offline persistence.");
                }
            });

        // DOM elements
        const loadingScreen = document.getElementById('loadingScreen');
        const ownerAccessBtn = document.getElementById('ownerAccessBtn');
        const requestShopModal = new bootstrap.Modal(document.getElementById('requestShopModal'));
        const requestDeliveryModal = new bootstrap.Modal(document.getElementById('requestDeliveryModal'));
        const notificationsModal = new bootstrap.Modal(document.getElementById('notificationsModal'));
        const loginRequiredModal = new bootstrap.Modal(document.getElementById('loginRequiredModal'));
        const submitOwnerCode = document.getElementById('submitOwnerCode');
        const ownerCode = document.getElementById('ownerCode');
        const ownerUsername = document.getElementById('ownerUsername');
        const addBtn = document.getElementById('addBtn');
        const addOptionsMenu = document.getElementById('addOptionsMenu');
        const addOptionsBackdrop = document.getElementById('addOptionsBackdrop');
        const addShopOption = document.getElementById('addShopOption');
        const addDeliveryOption = document.getElementById('addDeliveryOption');
        const accessShopOption = document.getElementById('accessShopOption');
        const accountInfo = document.getElementById('accountInfo');
        const accountNotLoggedIn = document.getElementById('accountNotLoggedIn');
        const accountLoggedIn = document.getElementById('accountLoggedIn');
        const loginAccountBtn = document.getElementById('loginAccountBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const logoutAccountBtn = document.getElementById('logoutAccountBtn');
        const supportForm = document.getElementById('supportForm');
        const mainContent = document.getElementById('mainContent');
        const shopsSection = document.getElementById('shopsSection');
        const deliverySection = document.getElementById('deliverySection');
        const categoriesSection = document.getElementById('categoriesSection');
        const categoryShopsContainer = document.getElementById('categoryShopsContainer');
        const themeToggle = document.getElementById('themeToggle');
        const themeLabel = document.getElementById('themeLabel');
        const notificationBadge = document.getElementById('notificationBadge');
        const notificationBadgeMenu = document.getElementById('notificationBadgeMenu');
        const notificationsBtn = document.getElementById('notificationsBtn');
        const shopOwnerInfo = document.getElementById('shopOwnerInfo');
        const shopNameDisplay = document.getElementById('shopNameDisplay');
        const shopExpiryDate = document.getElementById('shopExpiryDate');
        const markAllAsReadBtn = document.getElementById('markAllAsReadBtn');
        const backToMainBtn = document.getElementById('backToMainBtn');
        const backButtonContainer = document.getElementById('backButtonContainer');
        const searchPanel = document.getElementById('searchPanel');
        const searchPanelBackBtn = document.getElementById('searchPanelBackBtn');
        const searchPanelInput = document.getElementById('searchPanelInput');
        const searchPanelBtn = document.getElementById('searchPanelBtn');
        const recentSearchesContainer = document.getElementById('recentSearchesContainer');
        const supportPanel = document.getElementById('supportPanel');
        const supportPanelBackBtn = document.getElementById('supportPanelBackBtn');
        const supportBtn = document.getElementById('supportBtn');
        const englishBtn = document.getElementById('englishBtn');
        const arabicBtn = document.getElementById('arabicBtn');
        const favoriteShopsBtn = document.getElementById('favoriteShopsBtn');
        const favoritePanel = document.getElementById('favoritePanel');
        const favoritePanelBackBtn = document.getElementById('favoritePanelBackBtn');
        const favoriteShopsPanelContainer = document.getElementById('favoriteShopsPanelContainer');
        const searchBackToMainBtn = document.getElementById('searchBackToMainBtn');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const categoryFilter = document.getElementById('categoryFilter');
        const locationFilter = document.getElementById('locationFilter');
        const authButtons = document.getElementById('authButtons');
        const goToLoginBtn = document.getElementById('goToLoginBtn');
        const shopsLoader = document.getElementById('shopsLoader');
        const featuredShopsContainer = document.getElementById('featuredShopsContainer');
        const sliderDots = document.getElementById('sliderDots');
        const featuredShopsSection = document.getElementById('featuredShopsSection');
        
        let allShops = []; // Stores all loaded shops
        let allPremiumShops = []; // Stores all premium shops
        let featuredShops = []; // Stores featured shops for slider
        let isInitialLoad = true; // Flag for first load
        let currentSlide = 0; // Current slide index for featured shops
        let slideInterval; // Interval for auto-sliding featured shops
        
        // Current user data
        let currentUser = null;
        let currentUserData = null;
        let isSearching = false;
        let activeTab = 'home'; // 'home', 'delivery', or 'account'
        let currentCategory = null;
        let recentSearches = JSON.parse(localStorage.getItem('recentSearches')) || [];
        let isArabic = false;
        
        // Pagination variables
        let lastVisibleShop = null;
        let hasMoreShops = true;
        let isLoadingShops = false;

        // Show custom category field if "Other" is selected
        requesterCategory.addEventListener('change', () => {
            if (requesterCategory.value === 'Other') {
                customCategoryContainer.style.display = 'block';
            } else {
                customCategoryContainer.style.display = 'none';
            }
        });

        // Add button click handler
        addBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (!currentUser) {
                loginRequiredModal.show();
                return;
            }
            addOptionsMenu.style.display = 'block';
            addOptionsBackdrop.style.display = 'block';
        });

        // Add options menu handlers
        addShopOption.addEventListener('click', (e) => {
            e.preventDefault();
            addOptionsMenu.style.display = 'none';
            addOptionsBackdrop.style.display = 'none';
            requestShopModal.show();
        });

        addDeliveryOption.addEventListener('click', (e) => {
            e.preventDefault();
            addOptionsMenu.style.display = 'none';
            addOptionsBackdrop.style.display = 'none';
            requestDeliveryModal.show();
        });

        accessShopOption.addEventListener('click', (e) => {
            e.preventDefault();
            addOptionsMenu.style.display = 'none';
            addOptionsBackdrop.style.display = 'none';
            new bootstrap.Modal(document.getElementById('ownerAccessModal')).show();
        });

        // Close add options menu when clicking backdrop
        addOptionsBackdrop.addEventListener('click', () => {
            addOptionsMenu.style.display = 'none';
            addOptionsBackdrop.style.display = 'none';
        });

        // Notifications button click handler
        notificationsBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (!currentUser) {
                loginRequiredModal.show();
                return;
            }
            loadNotificationsModal();
            notificationsModal.show();
        });

        // Mark all notifications as read
        markAllAsReadBtn?.addEventListener('click', () => {
            db.collection('notifications')
                .where('read', '==', false)
                .get()
                .then(snapshot => {
                    const batch = db.batch();
                    
                    snapshot.forEach(doc => {
                        const ref = db.collection('notifications').doc(doc.id);
                        batch.update(ref, { read: true });
                    });
                    
                    return batch.commit();
                })
                .then(() => {
                    loadNotifications();
                    loadNotificationsModal();
                    showStatus('All notifications marked as read', 'success');
                })
                .catch(error => {
                    showStatus('Error marking notifications as read: ' + error.message, 'error');
                });
        });
        // Filter button click handler
filterBtn.addEventListener('click', () => {
    if (activeTab === 'home') {
        // Toggle shop filter panel
        const isVisible = shopFilterPanel.style.display === 'block';
        shopFilterPanel.style.display = isVisible ? 'none' : 'block';
        deliveryFilterPanel.style.display = 'none';
    } else if (activeTab === 'delivery') {
        // Toggle delivery filter panel
        const isVisible = deliveryFilterPanel.style.display === 'block';
        deliveryFilterPanel.style.display = isVisible ? 'none' : 'block';
        shopFilterPanel.style.display = 'none';
    }
});

// Apply shop filter
applyShopFilter.addEventListener('click', () => {
    const location = document.getElementById('shopLocationFilter').value;
    const searchTerm = searchInput.value.trim().toLowerCase();
    
    shopFilterPanel.style.display = 'none';
    performSearch(searchTerm, { location });
});

// Apply delivery filter
applyDeliveryFilter.addEventListener('click', () => {
    const from = document.getElementById('deliveryFromFilter').value;
    const to = document.getElementById('deliveryToFilter').value;
    const searchTerm = searchInput.value.trim().toLowerCase();
    
    deliveryFilterPanel.style.display = 'none';
    performSearch(searchTerm, { from, to });
});

// Close filter panels when clicking outside
document.addEventListener('click', (e) => {
    if (!filterBtn.contains(e.target) && 
        !shopFilterPanel.contains(e.target) && 
        !deliveryFilterPanel.contains(e.target)) {
        shopFilterPanel.style.display = 'none';
        deliveryFilterPanel.style.display = 'none';
    }
});

        // Bottom navigation click handlers
     // In the bottom navigation click handlers, update the tab switching logic
document.querySelectorAll('.bottom-nav-item').forEach(item => {
    item.addEventListener('click', (e) => {
        e.preventDefault();
        
        // Remove active class from all items
        document.querySelectorAll('.bottom-nav-item').forEach(navItem => {
            navItem.classList.remove('active');
        });
        
        // Add active class to clicked item
        item.classList.add('active');
        
        // Show/hide sections based on active tab
        const tabId = item.id;
        if (tabId === 'homeBtn') {
            activeTab = 'home';
            accountInfo.style.display = 'none';
            mainContent.style.display = 'block';
            deliverySection.style.display = 'none';
            shopsSection.style.display = 'none';
            categoriesSection.style.display = 'block';
            categoryShopsContainer.style.display = 'block';
            featuredShopsSection.style.display = 'block';
            backButtonContainer.style.display = 'none';
            searchInput.placeholder = 'Search for shops';
            
            // Reset search filters
           
            document.getElementById('locationFilter').value = '';
            
            // Reset pagination and reload state
            isInitialLoad = true;
            lastVisibleShop = null;
            hasMoreShops = true;
            currentCategory = null;
            
            loadFeaturedShops();
            loadCategoryShops();
        } else if (tabId === 'deliveryBtn') {
            activeTab = 'delivery';
            accountInfo.style.display = 'none';
            mainContent.style.display = 'block';
            deliverySection.style.display = 'block';
            shopsSection.style.display = 'none';
            categoriesSection.style.display = 'none';
            categoryShopsContainer.style.display = 'none';
            featuredShopsSection.style.display = 'none';
            backButtonContainer.style.display = 'none';
            searchInput.placeholder = 'Search for delivery services';
            
            // Reset search filters
            document.getElementById('deliveryFromFilter').value = '';
            document.getElementById('deliveryToFilter').value = '';
         
            
            loadDeliveries();
        } else if (tabId === 'accountBtn') {
            activeTab = 'account';
            mainContent.style.display = 'none';
            featuredShopsSection.style.display = 'none';
            accountInfo.style.display = 'block';
            loadAccountInfo();
        } else if (tabId === 'myShopBtn') {
            if (!currentUser) {
                loginRequiredModal.show();
                return;
            }
            if (currentUser && currentUserData && currentUserData.shopId) {
                // Redirect to shop access page with shop ID
                window.location.href = `${currentUserData.shopId}.html`;
            } else {
                new bootstrap.Modal(document.getElementById('ownerAccessModal')).show();
            }
        }
    });
});
        // Back to main button
        backToMainBtn.addEventListener('click', () => {
            currentCategory = null;
            backButtonContainer.style.display = 'none';
            loadCategoryShops();
        });

        // Theme toggle
        themeToggle.addEventListener('change', () => {
            if (themeToggle.checked) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
                themeLabel.textContent = isArabic ? 'الوضع الفاتح' : 'Light Mode';
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
                themeLabel.textContent = isArabic ? 'الوضع الداكن' : 'Dark Mode';
            }
        });

        // Language switcher
        englishBtn.addEventListener('click', () => {
            if (isArabic) {
                isArabic = false;
                englishBtn.classList.add('active');
                arabicBtn.classList.remove('active');
                translateToEnglish();
                localStorage.setItem('language', 'english');
            }
        });

        arabicBtn.addEventListener('click', () => {
            if (!isArabic) {
                isArabic = true;
                arabicBtn.classList.add('active');
                englishBtn.classList.remove('active');
                translateToArabic();
                localStorage.setItem('language', 'arabic');
            }
        });

        function translateToEnglish() {
            // Update all text elements to English
            document.querySelector('.navbar-brand').innerHTML = '<i class="fas fa-store me-2"></i>Shop Management';
            document.getElementById('homeBtn').innerHTML = '<i class="fas fa-home"></i><span>Home</span>';
            document.getElementById('myShopBtn').innerHTML = '<i class="fas fa-store"></i><span>My Shop</span>';
            document.getElementById('deliveryBtn').innerHTML = '<i class="fas fa-truck"></i><span>Delivery</span>';
            document.getElementById('accountBtn').innerHTML = '<i class="fas fa-user"></i><span>Account</span>';
            document.getElementById('themeLabel').textContent = themeToggle.checked ? 'Light Mode' : 'Dark Mode';
            document.getElementById('favoriteShopsBtn').innerHTML = '<i class="fas fa-heart me-2"></i>Favorite Shops';
            document.getElementById('supportBtn').innerHTML = '<i class="fas fa-headset me-2"></i>Customer Support';
            document.getElementById('logoutAccountBtn').innerHTML = '<i class="fas fa-sign-out-alt me-2"></i>Logout';
            document.getElementById('searchInput').placeholder = 'Search for shops';
            document.getElementById('searchPanelInput').placeholder = 'Search for shops or deliveries';
            
            // Update category names
            document.querySelectorAll('.category-name').forEach((el, index) => {
                const categories = ['Restaurants', 'Groceries', 'Pharmacies', 'Electronics', 'Clothing', 'Furniture', 'Automotive', 'Beauty', 'Other'];
                if (index < categories.length) {
                    el.textContent = categories[index];
                }
            });
            
            // Update section titles
            document.querySelectorAll('.section-title').forEach(el => {
                if (el.textContent.includes('Explore Categories')) el.textContent = 'Explore Categories';
                if (el.textContent.includes('Featured Shops')) el.textContent = 'Featured Shops';
                if (el.textContent.includes('All Shops')) el.textContent = 'All Shops';
                if (el.textContent.includes('Delivery Services')) el.textContent = 'Delivery Services';
            });
            
            // Update search panel
            document.querySelector('#searchPanel h5').textContent = 'Search';
            document.querySelector('#searchPanel .recent-searches h6').textContent = 'Recent Searches';
            document.getElementById('searchBackToMainBtn').innerHTML = '<i class="fas fa-arrow-left me-2"></i> Back to main page';
            
            // Update favorite panel
            document.querySelector('#favoritePanel h5').textContent = 'Favorite Shops';
            
            // Update support panel
            document.querySelector('#supportPanel h5').textContent = 'Customer Support';
            document.querySelector('#supportForm label[for="supportSubject"]').textContent = 'Subject';
            document.querySelector('#supportForm label[for="supportMessage"]').textContent = 'Message';
            document.querySelector('#supportForm button').innerHTML = '<i class="fas fa-paper-plane me-2"></i>Send Message';
            document.querySelector('#messagesList h5').innerHTML = '<i class="fas fa-envelope me-2"></i>Your Messages';
        }

        function translateToArabic() {
            // Update all text elements to Arabic
            document.querySelector('.navbar-brand').innerHTML = '<i class="fas fa-store me-2"></i>إدارة المتاجر';
            document.getElementById('homeBtn').innerHTML = '<i class="fas fa-home"></i><span>الرئيسية</span>';
            document.getElementById('myShopBtn').innerHTML = '<i class="fas fa-store"></i><span>متجري</span>';
            document.getElementById('deliveryBtn').innerHTML = '<i class="fas fa-truck"></i><span>التوصيل</span>';
            document.getElementById('accountBtn').innerHTML = '<i class="fas fa-user"></i><span>الحساب</span>';
            document.getElementById('themeLabel').textContent = themeToggle.checked ? 'الوضع الفاتح' : 'الوضع الداكن';
            document.getElementById('favoriteShopsBtn').innerHTML = '<i class="fas fa-heart me-2"></i>المتاجر المفضلة';
            document.getElementById('supportBtn').innerHTML = '<i class="fas fa-headset me-2"></i>خدمة العملاء';
            document.getElementById('logoutAccountBtn').innerHTML = '<i class="fas fa-sign-out-alt me-2"></i>تسجيل الخروج';
            document.getElementById('searchInput').placeholder = 'ابحث عن متاجر';
            document.getElementById('searchPanelInput').placeholder = 'ابحث عن متاجر أو خدمات توصيل';
            
            // Update category names
            document.querySelectorAll('.category-name').forEach((el, index) => {
                const categories = ['مطاعم', 'بقالة', 'صيدليات', 'إلكترونيات', 'ملابس', 'أثاث', 'سيارات', 'جمال', 'أخرى'];
                if (index < categories.length) {
                    el.textContent = categories[index];
                }
            });
            
            // Update section titles
            document.querySelectorAll('.section-title').forEach(el => {
                if (el.textContent.includes('Explore Categories')) el.textContent = 'تصفح الفئات';
                if (el.textContent.includes('Featured Shops')) el.textContent = 'متاجر مميزة';
                if (el.textContent.includes('All Shops')) el.textContent = 'جميع المتاجر';
                if (el.textContent.includes('Delivery Services')) el.textContent = 'خدمات التوصيل';
            });
            
            // Update search panel
            document.querySelector('#searchPanel h5').textContent = 'بحث';
            document.querySelector('#searchPanel .recent-searches h6').textContent = 'عمليات البحث الأخيرة';
            document.getElementById('searchBackToMainBtn').innerHTML = '<i class="fas fa-arrow-left me-2"></i> العودة للصفحة الرئيسية';
            
            // Update favorite panel
            document.querySelector('#favoritePanel h5').textContent = 'المتاجر المفضلة';
            
            // Update support panel
            document.querySelector('#supportPanel h5').textContent = 'خدمة العملاء';
            document.querySelector('#supportForm label[for="supportSubject"]').textContent = 'الموضوع';
            document.querySelector('#supportForm label[for="supportMessage"]').textContent = 'الرسالة';
            document.querySelector('#supportForm button').innerHTML = '<i class="fas fa-paper-plane me-2"></i>إرسال الرسالة';
            document.querySelector('#messagesList h5').innerHTML = '<i class="fas fa-envelope me-2"></i>رسائلك';
        }

        // Check saved theme preference
        function checkTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeToggle.checked = true;
                themeLabel.textContent = isArabic ? 'الوضع الفاتح' : 'Light Mode';
            } else {
                document.body.classList.remove('dark-mode');
                themeToggle.checked = false;
                themeLabel.textContent = isArabic ? 'الوضع الداكن' : 'Dark Mode';
            }
        }

        // Check saved language preference
        function checkLanguage() {
            const savedLanguage = localStorage.getItem('language');
            if (savedLanguage === 'arabic') {
                isArabic = true;
                arabicBtn.classList.add('active');
                englishBtn.classList.remove('active');
                translateToArabic();
            } else {
                isArabic = false;
                englishBtn.classList.add('active');
                arabicBtn.classList.remove('active');
                translateToEnglish();
            }
        }

        // Owner access
        ownerAccessBtn.addEventListener('click', () => {
            new bootstrap.Modal(document.getElementById('ownerAccessModal')).show();
        });

        submitOwnerCode.addEventListener('click', () => {
            const code = ownerCode.value.trim();
            const username = ownerUsername.value.trim();
            
            if (!username) {
                showStatus('Please enter your username', 'error');
                return;
            }
            
            if (!code) {
                showStatus('Please enter your shop code', 'error');
                return;
            }
            
            // Check if shop exists with this access code and owner name
            db.collection('shops')
                .where('ownerAccessCode', '==', code)
                .where('ownerName', '==', username)
                .get()
                .then(querySnapshot => {
                    if (!querySnapshot.empty) {
                        const doc = querySnapshot.docs[0];
                        const shopId = doc.id;
                        const shopData = doc.data();
                        
                        if (currentUser) {
                            // Use set() with merge instead of update()
                            db.collection('users').doc(currentUser.uid).set({
                                shopId: shopId
                            }, { merge: true }).then(() => {
                                currentUserData.shopId = shopId;
                                shopOwnerInfo.style.display = 'block';
                                shopNameDisplay.textContent = shopData.name;
                                shopExpiryDate.textContent = new Date(shopData.expiryDate).toLocaleDateString();
                                window.location.href = `${shopId}.html`;
                            });
                        } else {
                            window.location.href = `${shopId}.html`;
                        }
                        
                        new bootstrap.Modal(document.getElementById('ownerAccessModal')).hide();
                    } else {
                        showStatus('Invalid shop access code or username', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error verifying access:', error);
                    showStatus('Error verifying access: ' + error.message, 'error');
                });
        });

        // Login handler
        loginAccountBtn.addEventListener('click', () => {
            // Redirect to login page
            window.location.href = 'login.html';
        });

        // Go to login from login required modal
        goToLoginBtn.addEventListener('click', () => {
            window.location.href = 'login.html';
        });

        // Logout handlers
        logoutBtn.addEventListener('click', () => {
            logout();
        });

        logoutAccountBtn.addEventListener('click', () => {
            logout();
        });

        function logout() {
            auth.signOut().then(() => {
                currentUser = null;
                currentUserData = null;
                localStorage.removeItem('adminAccess');
                showStatus('Logged out successfully', 'success');
                loadAccountInfo();
                updateAuthButtons();
            }).catch(error => {
                showStatus('Error logging out: ' + error.message, 'error');
            });
        }

        // Generate random code for shop owner
        function generateAccessCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        // Convert image file to base64 data URL
        function getImageDataUrl(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        // Submit shop request
        const requestShopForm = document.getElementById('requestShopForm');
        requestShopForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('requesterName').value;
            const phone = document.getElementById('requesterPhone').value;
            const location = document.getElementById('requesterLocation').value;
            let category = document.getElementById('requesterCategory').value;
            
            if (category === 'Other') {
                category = document.getElementById('customCategory').value || 'Other';
            }
            
            if (!name || !phone || !location || !category) {
                showStatus('Please fill in all required fields', 'error');
                return;
            }
            
            try {
                // Save request data to Firestore
                await db.collection('requests').add({
                    name,
                    phone,
                    location,
                    category,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Reset form
                requestShopForm.reset();
                requestShopModal.hide();
                
                showStatus('Request submitted successfully! We will contact you soon.', 'success');
            } catch (error) {
                console.error('Error submitting request:', error);
                showStatus('Error submitting request: ' + error.message, 'error');
            }
        });

        // Add event listeners for filter changes



// For delivery filters
deliveryFromFilter.addEventListener('change', () => {
    const searchTerm = searchPanelInput.value.trim().toLowerCase();
    const filters = {
        from: deliveryFromFilter.value,
        to: deliveryToFilter.value
    };
    performSearch(searchTerm, filters);
});

deliveryToFilter.addEventListener('change', () => {
    const searchTerm = searchPanelInput.value.trim().toLowerCase();
    const filters = {
        from: deliveryFromFilter.value,
        to: deliveryToFilter.value
    };
    performSearch(searchTerm, filters);
});

        // Submit delivery request
        
        const requestDeliveryForm = document.getElementById('requestDeliveryForm');
        requestDeliveryForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('deliveryName').value;
            const phone = document.getElementById('deliveryPhone').value;
            const from = document.getElementById('deliveryFrom').value;
            const to = document.getElementById('deliveryTo').value;
            const hours = document.getElementById('deliveryHours').value;
          
const price = document.getElementById('deliveryPrice').value || 0;

            
            if (!name || !phone || !from || !to || !hours) {
                showStatus('Please fill in all required fields', 'error');
                return;
            }
            
            try {
                // Save request data to Firestore
                await db.collection('deliveryRequests').add({
                    name,
                    phone,
                    from,
                    to,
                    hours,
                    price: Number(price),
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Reset form
                requestDeliveryForm.reset();
                requestDeliveryModal.hide();
                
                showStatus('Delivery request submitted successfully! We will contact you soon.', 'success');
            } catch (error) {
                console.error('Error submitting delivery request:', error);
                showStatus('Error submitting delivery request: ' + error.message, 'error');
            }
        });

        // Submit support message
        supportForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const subject = document.getElementById('supportSubject').value;
            const message = document.getElementById('supportMessage').value;
            
            if (!subject || !message) {
                showStatus('Please fill in all required fields', 'error');
                return;
            }
            
            try {
                // Save support message to Firestore
                await db.collection('supportMessages').add({
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    userName: currentUserData?.name || currentUser.email,
                    subject,
                    message,
                    status: 'unread',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    replies: []
                });
                
                // Reset form
                supportForm.reset();
                
                // Reload messages
                loadUserMessages();
                
                showStatus('Your message has been sent to our support team!', 'success');
            } catch (error) {
                console.error('Error submitting support message:', error);
                showStatus('Error submitting message: ' + error.message, 'error');
            }
        });

        // Load notifications
 function loadNotifications() {
    if (!currentUser) {
        notificationBadge.style.display = 'none';
        notificationBadgeMenu.style.display = 'none';
        return;
    }
    
    // Check both user notifications and admin notifications if user is admin
    let query;
    if (currentUserData?.isAdmin) {
        query = db.collection('adminNotifications')
            .where('read', '==', false);
    } else {
        query = db.collection('users').doc(currentUser.uid)
            .collection('notifications')
            .where('read', '==', false);
    }
    
    query.get()
        .then(snapshot => {
            const unreadCount = snapshot.size;
            
            // Update notification badge
            if (unreadCount > 0) {
                notificationBadge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                notificationBadge.style.display = 'flex';
                notificationBadgeMenu.textContent = unreadCount > 9 ? '9+' : unreadCount;
                notificationBadgeMenu.style.display = 'inline-block';
            } else {
                notificationBadge.style.display = 'none';
                notificationBadgeMenu.style.display = 'none';
            }
        })
        .catch(error => {
            console.error('Error loading notifications:', error);
            notificationBadge.style.display = 'none';
            notificationBadgeMenu.style.display = 'none';
        });
}

// Load notifications modal
function loadNotificationsModal() {
    const modalBody = document.getElementById('notificationsModalBody');
    modalBody.innerHTML = '<div class="text-center py-3"><i class="fas fa-spinner fa-spin me-2"></i>Loading notifications...</div>';
    
    db.collection('users').doc(currentUser.uid)
        .collection('notifications')
        .orderBy('createdAt', 'desc')
        .limit(10)
        .get()
        .then(snapshot => {
            if (snapshot.empty) {
                modalBody.innerHTML = '<div class="alert alert-info text-center py-4">No notifications found</div>';
                return;
            }
            
            let notificationsHtml = '';
            snapshot.forEach(doc => {
                const notification = doc.data();
                const timeAgo = formatTimeAgo(notification.createdAt.toDate());
                
                notificationsHtml += `
                    <div class="notification-item ${!notification.read ? 'unread' : ''}" data-id="${doc.id}">
                        <div class="fw-bold">${notification.title}</div>
                        <div class="small">${notification.message}</div>
                        <div class="notification-time">${timeAgo}</div>
                    </div>
                    <hr>
                `;
            });
            
            modalBody.innerHTML = notificationsHtml;
            
            // Add click handlers to mark as read
            document.querySelectorAll('.notification-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const notificationId = item.getAttribute('data-id');
                    
                    db.collection('users').doc(currentUser.uid)
                        .collection('notifications').doc(notificationId)
                        .update({
                            read: true
                        })
                        .then(() => {
                            loadNotifications();
                            loadNotificationsModal();
                        });
                });
            });
        });
}
    

        // Format time ago
        function formatTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `${days}d ago`;
            if (hours > 0) return `${hours}h ago`;
            if (minutes > 0) return `${minutes}m ago`;
            return `${seconds}s ago`;
        }

        // Load featured shops for slider
      
    // Load featured shops for slider
function loadFeaturedShops() {
    featuredShopsContainer.innerHTML = '';
    sliderDots.innerHTML = '';
    
    // Show skeleton loader
    const skeletonCard = document.createElement('div');
    skeletonCard.className = 'featured-shop-card';
    skeletonCard.innerHTML = `
        <div class="skeleton-loader" style="height: 100%; width: 100%;"></div>
    `;
    featuredShopsContainer.appendChild(skeletonCard);
    
    // Load premium shops (featured shops)
    db.collection('shops')
        .where('isPublic', '==', true)
        .where('isPremium', '==', true)
        .orderBy('createdAt', 'desc')
        .limit(6)
        .get()
        .then(snapshot => {
            featuredShops = [];
            snapshot.forEach(doc => {
                const shop = doc.data();
                shop.id = doc.id;
                featuredShops.push(shop);
            });
            
            if (featuredShops.length === 0) {
                featuredShopsSection.style.display = 'none';
                return;
            }
            
            displayFeaturedShops();
            setupSliderTouch();
            
            // Only start auto-sliding if we have more than 1 shop
            if (featuredShops.length > 1) {
                startSlider();
            }
        })
        .catch(error => {
            console.error('Error loading featured shops:', error);
            featuredShopsSection.style.display = 'none';
        });
}
// Display featured shops in slider
function displayFeaturedShops() {
    featuredShopsContainer.innerHTML = '';
    sliderDots.innerHTML = '';
    
    if (featuredShops.length === 0) {
        featuredShopsSection.style.display = 'none';
        return;
    }
    
    // Create shop cards
    featuredShops.forEach((shop, index) => {
        const card = document.createElement('div');
        card.className = 'featured-shop-card';
        card.onclick = () => showShopDetails(shop);
        
        card.innerHTML = `
            <div class="featured-badge"><i class="fas fa-crown me-1"></i>Featured</div>
            <img src="${shop.imageUrl}" class="shop-img lazy-img" alt="${shop.name}">
            <div class="featured-shop-overlay">
                <h5>${shop.name}</h5>
                <p>${shop.category} • ${shop.location}</p>
            </div>
        `;
        
        featuredShopsContainer.appendChild(card);
    });
    
    // Create slider dots
    for (let i = 0; i < featuredShops.length; i++) {
        const dot = document.createElement('div');
        dot.className = 'slider-dot';
        if (i === 0) dot.classList.add('active');
        dot.addEventListener('click', () => {
            goToSlide(i);
        });
        sliderDots.appendChild(dot);
    }
    
    // Initialize to show first slide
    goToSlide(0);
}

// Setup touch events for manual scrolling
function setupSliderTouch() {
    let touchStartX = 0;
    let touchEndX = 0;
    const threshold = 50; // Minimum swipe distance
    
    featuredShopsContainer.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
        clearInterval(slideInterval); // Stop auto-sliding when user interacts
    }, { passive: true });
    
    featuredShopsContainer.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
        startSlider(); // Restart auto-sliding after user interaction
    }, { passive: true });
    
    function handleSwipe() {
        const diff = touchStartX - touchEndX;
        
        if (diff > threshold) {
            // Swipe left - go to next slide
            nextSlide();
        } else if (diff < -threshold) {
            // Swipe right - go to previous slide
            prevSlide();
        }
    }
}

// Go to next slide
function nextSlide() {
    if (currentSlide === featuredShops.length - 1) {
        // If at last slide, reverse direction
        currentSlide--;
    } else {
        currentSlide++;
    }
    updateSlider();
}

// Go to previous slide
function prevSlide() {
    if (currentSlide === 0) {
        // If at first slide, reverse direction
        currentSlide++;
    } else {
        currentSlide--;
    }
    updateSlider();
}

// Go to specific slide
function goToSlide(index) {
    currentSlide = index;
    updateSlider();
}

// Update slider position and active dot
function updateSlider() {
    const container = document.querySelector('.featured-shops-container');
    const dots = document.querySelectorAll('.slider-dot');
    
    // Calculate the offset to show the current slide
    const offset = -currentSlide * 100;
    
    container.style.transform = `translateX(${offset}%)`;
    
    // Update active dot
    dots.forEach((dot, index) => {
        if (index === currentSlide) {
            dot.classList.add('active');
        } else {
            dot.classList.remove('active');
        }
    });
}

// Start auto-sliding with bounce effect
// Start auto-sliding with bounce effect
function startSlider() {
    clearInterval(slideInterval);
    
    // Don't start slider if we have only 1 shop
    if (featuredShops.length <= 1) return;
    
    let isGoingForward = true;
    
    slideInterval = setInterval(() => {
        if (currentSlide === featuredShops.length - 1) {
            // At end - reverse direction
            isGoingForward = false;
            currentSlide--;
        } else if (currentSlide === 0) {
            // At start - go forward
            isGoingForward = true;
            currentSlide++;
        } else {
            // Continue in current direction
            currentSlide = isGoingForward ? currentSlide + 1 : currentSlide - 1;
        }
        
        updateSlider();
    }, 3000); // Change slide every 3 seconds
}
        // Go to next slide
   // Go to next slide
function nextSlide() {
    if (currentSlide < featuredShops.length - 1) {
        currentSlide++;
    } else {
        // If at last slide, go back to first
        currentSlide = 0;
    }
    updateSlider();
}

// Go to previous slide
function prevSlide() {
    if (currentSlide > 0) {
        currentSlide--;
    } else {
        // If at first slide, go to last
        currentSlide = featuredShops.length - 1;
    }
    updateSlider();
}

        // Update slider position and active dot
  // Update slider position and active dot
function updateSlider() {
    const container = document.querySelector('.featured-shops-container');
    const dots = document.querySelectorAll('.slider-dot');
    
    // Calculate the offset to show the current slide
    const offset = -currentSlide * 100;
    
    container.style.transform = `translateX(${offset}%)`;
    
    // Update active dot
    dots.forEach((dot, index) => {
        if (index === currentSlide) {
            dot.classList.add('active');
        } else {
            dot.classList.remove('active');
        }
    });
}
        // Load shops by category (OLX style)
        function loadCategoryShops() {
            const categories = [
                'Restaurant', 'Grocery', 'Pharmacy', 'Electronics', 
                'Clothing', 'Furniture', 'Automotive', 'Beauty', 'Other'
            ];
            
            categoryShopsContainer.innerHTML = '';
            
            categories.forEach(category => {
                // Create a container for each category
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category-shops';
                categoryDiv.id = `category-${category.toLowerCase()}`;
                
                // Create the header with "View All" button
                const headerDiv = document.createElement('div');
                headerDiv.className = 'category-header';
                headerDiv.innerHTML = `
                    <h6 class="section-title">${category}</h6>
                    <a href="category.html?cat=${category.toLowerCase()}" class="view-all-btn">View All</a>
                `;
                
                // Create the shops slider
                const sliderDiv = document.createElement('div');
                sliderDiv.className = 'shops-slider';
                sliderDiv.id = `slider-${category.toLowerCase()}`;
                
                // Add skeleton loader
                for (let i = 0; i < 6; i++) {
                    const skeletonCard = document.createElement('div');
                    skeletonCard.className = 'skeleton-loader skeleton-card';
                    skeletonCard.style.width = '200px';
                    skeletonCard.style.marginRight = '15px';
                    skeletonCard.style.flexShrink = '0';
                    skeletonCard.innerHTML = `
                        <div class="skeleton-image" style="height: 150px;"></div>
                        <div class="skeleton-content">
                            <div class="skeleton-text"></div>
                            <div class="skeleton-text short"></div>
                        </div>
                    `;
                    sliderDiv.appendChild(skeletonCard);
                }
                
                categoryDiv.appendChild(headerDiv);
                categoryDiv.appendChild(sliderDiv);
                categoryShopsContainer.appendChild(categoryDiv);
                
                // Load shops for this category
                loadShopsForCategory(category);
            });
        }

        // Load shops for a specific category
        function loadShopsForCategory(category) {
            const sliderId = `slider-${category.toLowerCase()}`;
            const slider = document.getElementById(sliderId);
            
            db.collection('shops')
                .where('isPublic', '==', true)
                .where('category', '==', category)
                .orderBy('createdAt', 'desc')
                .limit(6)
                .get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        // Hide this category if no shops found
                        document.getElementById(`category-${category.toLowerCase()}`).style.display = 'none';
                        return;
                    }
                    
                    slider.innerHTML = ''; // Clear skeleton loaders
                    
                    snapshot.forEach(doc => {
                        const shop = doc.data();
                        shop.id = doc.id;
                        
                        const shopCard = document.createElement('div');
                        shopCard.className = `shop-card ${shop.isPremium ? 'premium' : ''}`;
                        shopCard.style.width = '200px';
                        shopCard.style.marginRight = '15px';
                        shopCard.style.flexShrink = '0';
                        shopCard.onclick = (e) => {
                            e.stopPropagation(); // Prevent event bubbling
                            showShopDetails(shop);
                        };
                        
                        shopCard.innerHTML = `
                            ${shop.isPremium ? '<div class="premium-badge"><i class="fas fa-crown me-1"></i>Premium</div>' : ''}
                            ${shop.hasDelivery ? '<div class="delivery-badge"><i class="fas fa-truck me-1"></i>Delivery</div>' : ''}
                            <button class="favorite-btn" data-shop-id="${shop.id}">
                                <i class="far fa-heart"></i>
                            </button>
                            <div class="shop-img lazy-img" style="background-image: url('${shop.imageUrl}')"></div>
                            <div class="p-3">
                                <h6>${shop.name}</h6>
                                <p class="text-muted small"><i class="fas fa-map-marker-alt me-1"></i>${shop.location}</p>
                            </div>
                        `;
                        
                        slider.appendChild(shopCard);
                        
                        // Initialize favorite button
                        const favoriteBtn = shopCard.querySelector('.favorite-btn');
                        if (currentUser && currentUserData && currentUserData.favoriteShops && currentUserData.favoriteShops.includes(shop.id)) {
                            favoriteBtn.innerHTML = '<i class="fas fa-heart" style="color: red;"></i>';
                            favoriteBtn.classList.add('active');
                        }
                        
                        favoriteBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            toggleFavoriteShop(shop.id, favoriteBtn);
                        });
                    });
                })
                .catch(error => {
                    console.error(`Error loading ${category} shops:`, error);
                    slider.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>Error loading shops
                        </div>
                    `;
                });
        }

        // Load deliveries for display
        function loadDeliveries() {
            const container = document.getElementById('deliveryContainer');
            
            // Show skeleton loaders
            container.innerHTML = '';
            for (let i = 0; i < 2; i++) {
                const col = document.createElement('div');
                col.className = 'col-md-6';
                col.innerHTML = `
                    <div class="skeleton-loader skeleton-card">
                        <div class="skeleton-image"></div>
                        <div class="skeleton-content">
                            <div class="skeleton-text"></div>
                            <div class="skeleton-text short"></div>
                            <div class="skeleton-text short"></div>
                            <div class="skeleton-text short"></div>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            }
            
            db.collection('deliveries')
                .where('isPublic', '==', true)
                .orderBy('createdAt', 'desc')
                .get()
                .then(snapshot => {
                    const deliveries = [];
                    snapshot.forEach(doc => {
                        const delivery = doc.data();
                        delivery.id = doc.id; // Add the document ID to the delivery object
                        deliveries.push(delivery);
                    });
                    
                    displayDeliveries(deliveries);
                });
        }

  function performSearch(searchTerm = '', filters = {}) {
    const container = activeTab === 'home' ? document.getElementById('allShopsContainer') : document.getElementById('deliveryContainer');
    
    // Show skeleton loaders
    container.innerHTML = '';
    for (let i = 0; i < 6; i++) {
        const col = document.createElement('div');
        col.className = activeTab === 'home' ? 'col-md-4 col-6' : 'col-md-6';
        col.innerHTML = `
            <div class="skeleton-loader skeleton-card">
                <div class="skeleton-image"></div>
                <div class="skeleton-content">
                    <div class="skeleton-text"></div>
                    <div class="skeleton-text short"></div>
                    ${activeTab === 'delivery' ? '<div class="skeleton-text short"></div><div class="skeleton-text short"></div>' : ''}
                </div>
            </div>
        `;
        container.appendChild(col);
    }
    
    if (activeTab === 'home') {
        // Search shops
        let query = db.collection('shops').where('isPublic', '==', true);
        
        query.get().then(snapshot => {
            const filteredShops = [];
            
            snapshot.forEach(doc => {
                const shop = doc.data();
                shop.id = doc.id;
                
                // Check if matches search term in name or description
                const matchesSearch = !searchTerm || 
                                     shop.name.toLowerCase().includes(searchTerm) || 
                                     shop.description.toLowerCase().includes(searchTerm);
                
                // Check location filter if provided
                const matchesLocation = !filters.location || shop.location === filters.location;
                
                if (matchesSearch && matchesLocation) {
                    filteredShops.push(shop);
                }
            });
            
            // Hide categories and show all shops container
            categoriesSection.style.display = 'none';
            categoryShopsContainer.style.display = 'none';
            shopsSection.style.display = 'block';
            
            // Display filtered results in all shops container
            displayShops(filteredShops, 'allShopsContainer');
            
            showStatus(`Found ${filteredShops.length} matching shops`, 'info');
        });
    } else if (activeTab === 'delivery') {
        // Search deliveries
        let query = db.collection('deliveries').where('isPublic', '==', true);
        
        query.get().then(snapshot => {
            const filteredDeliveries = [];
            
            snapshot.forEach(doc => {
                const delivery = doc.data();
                delivery.id = doc.id;
                
                // Check search term in name or description
                const matchesSearch = !searchTerm || 
                                     delivery.name.toLowerCase().includes(searchTerm) || 
                                     (delivery.description && delivery.description.toLowerCase().includes(searchTerm));
                
                // Check location filters
                const matchesFrom = !filters.from || delivery.from === filters.from;
                const matchesTo = !filters.to || delivery.to === filters.to;
                
                if (matchesSearch && matchesFrom && matchesTo) {
                    filteredDeliveries.push(delivery);
                }
            });
            
            // Display filtered results
            displayDeliveries(filteredDeliveries);
            
            showStatus(`Found ${filteredDeliveries.length} matching delivery services`, 'info');
        });
    }
}
        // Display shops in a container (with append option for pagination)
        function displayShops(shops, containerId, append = false) {
            const container = document.getElementById(containerId);
            
            if (!append) {
                container.innerHTML = '';
            }
            
            if (shops.length === 0 && !append) {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-info text-center py-4">
                            <i class="fas fa-info-circle me-2"></i>No shops found
                        </div>
                    </div>
                `;
                return;
            }
            
            shops.forEach(shop => {
                const col = document.createElement('div');
                col.className = 'col-md-4 col-6';
                
                const card = document.createElement('div');
                card.className = `shop-card ${shop.isPremium ? 'premium' : ''}`;
                card.onclick = (e) => {
                    e.stopPropagation(); // Prevent event bubbling
                    showShopDetails(shop);
                };
                
                card.innerHTML = `
                    ${shop.isPremium ? '<div class="premium-badge"><i class="fas fa-crown me-1"></i>Premium</div>' : ''}
                    ${shop.hasDelivery ? '<div class="delivery-badge"><i class="fas fa-truck me-1"></i>Delivery</div>' : ''}
                    <button class="favorite-btn" data-shop-id="${shop.id}">
                        <i class="far fa-heart"></i>
                    </button>
                    <div class="shop-img lazy-img" style="background-image: url('${shop.imageUrl}')"></div>
                    <div class="p-3">
                        <h6>${shop.name}</h6>
                        <p class="text-muted small"><i class="fas fa-tag me-1"></i>${shop.category} • <i class="fas fa-map-marker-alt me-1"></i>${shop.location}</p>
                    </div>
                `;
                
                col.appendChild(card);
                container.appendChild(col);
                
                // Initialize favorite button
                const favoriteBtn = card.querySelector('.favorite-btn');
                if (currentUser && currentUserData && currentUserData.favoriteShops && currentUserData.favoriteShops.includes(shop.id)) {
                    favoriteBtn.innerHTML = '<i class="fas fa-heart" style="color: red;"></i>';
                    favoriteBtn.classList.add('active');
                }
                
                favoriteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleFavoriteShop(shop.id, favoriteBtn);
                });
            });
        }

        // Toggle favorite shop
        function toggleFavoriteShop(shopId, button) {
            if (!currentUser) {
                loginRequiredModal.show();
                return;
            }
            
            const userRef = db.collection('users').doc(currentUser.uid);
            const isFavorite = button.classList.contains('active');
            
            if (isFavorite) {
                // Remove from favorites
                userRef.update({
                    favoriteShops: firebase.firestore.FieldValue.arrayRemove(shopId)
                }).then(() => {
                    button.innerHTML = '<i class="far fa-heart"></i>';
                    button.classList.remove('active');
                    loadFavoriteShops();
                    loadFavoriteShopsPanel();
                });
            } else {
                // Add to favorites
                userRef.set({
                    favoriteShops: firebase.firestore.FieldValue.arrayUnion(shopId)
                }, { merge: true }).then(() => {
                    button.innerHTML = '<i class="fas fa-heart" style="color: red;"></i>';
                    button.classList.add('active');
                    loadFavoriteShops();
                    loadFavoriteShopsPanel();
                });
            }
        }

        // Load favorite shops for account section
        function loadFavoriteShops() {
            if (!currentUser || !currentUserData || !currentUserData.favoriteShops || currentUserData.favoriteShops.length === 0) {
                return;
            }
        }

        // Load favorite shops panel
        function loadFavoriteShopsPanel() {
            if (!currentUser || !currentUserData || !currentUserData.favoriteShops || currentUserData.favoriteShops.length === 0) {
                favoriteShopsPanelContainer.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>No favorite shops yet
                    </div>
                `;
                return;
            }
            
            favoriteShopsPanelContainer.innerHTML = '<div class="loading-spinner"><div class="spinner"></div></div>';
            
            // Get all favorite shops
            const favoriteShopIds = currentUserData.favoriteShops;
            const promises = favoriteShopIds.map(shopId => 
                db.collection('shops').doc(shopId).get()
            );
            
            Promise.all(promises).then(snapshots => {
                const favoriteShops = [];
                
                snapshots.forEach(snapshot => {
                    if (snapshot.exists) {
                        const shop = snapshot.data();
                        shop.id = snapshot.id;
                        favoriteShops.push(shop);
                    }
                });
                
                if (favoriteShops.length === 0) {
                    favoriteShopsPanelContainer.innerHTML = `
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>No favorite shops found
                        </div>
                    `;
                    return;
                }
                
                // Display favorite shops
                const row = document.createElement('div');
                row.className = 'row g-3';
                
                favoriteShops.forEach(shop => {
                    const col = document.createElement('div');
                    col.className = 'col-md-4 col-6';
                    
                    const card = document.createElement('div');
                    card.className = `shop-card ${shop.isPremium ? 'premium' : ''}`;
                    card.onclick = (e) => {
                        e.stopPropagation(); // Prevent event bubbling
                        showShopDetails(shop);
                    };
                    
                    card.innerHTML = `
                        ${shop.isPremium ? '<div class="premium-badge"><i class="fas fa-crown me-1"></i>Premium</div>' : ''}
                        ${shop.hasDelivery ? '<div class="delivery-badge"><i class="fas fa-truck me-1"></i>Delivery</div>' : ''}
                        <button class="favorite-btn active" data-shop-id="${shop.id}">
                            <i class="fas fa-heart" style="color: red;"></i>
                        </button>
                        <div class="shop-img lazy-img" style="background-image: url('${shop.imageUrl}')"></div>
                        <div class="p-3">
                            <h6>${shop.name}</h6>
                            <p class="text-muted small"><i class="fas fa-tag me-1"></i>${shop.category} • <i class="fas fa-map-marker-alt me-1"></i>${shop.location}</p>
                        </div>
                    `;
                    
                    col.appendChild(card);
                    row.appendChild(col);
                    
                    // Initialize favorite button
                    const favoriteBtn = card.querySelector('.favorite-btn');
                    favoriteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleFavoriteShop(shop.id, favoriteBtn);
                    });
                });
                
                favoriteShopsPanelContainer.innerHTML = '';
                favoriteShopsPanelContainer.appendChild(row);
            });
        }

        // Display deliveries in a container
        function displayDeliveries(deliveries) {
            const container = document.getElementById('deliveryContainer');
            container.innerHTML = '';
            
            if (deliveries.length === 0) {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-info text-center py-4">
                            <i class="fas fa-info-circle me-2"></i>No delivery services available
                        </div>
                    </div>
                `;
                return;
            }
            
            deliveries.forEach(delivery => {
                const col = document.createElement('div');
                col.className = 'col-md-6';
                
                const card = document.createElement('div');
                card.className = 'delivery-card';
                
                // Format phone number for WhatsApp
                const whatsappNumber = delivery.phone.replace(/\D/g, ''); // Remove non-numeric characters
                const whatsappLink = `https://wa.me/${whatsappNumber}`;
                
                // In the displayDeliveries function
card.innerHTML = `
    <h6>${delivery.name}</h6>
    <div class="delivery-info">
        <i class="fas fa-phone"></i>
        <span>${delivery.phone}</span>
    </div>
    <div class="delivery-info">
        <i class="fas fa-route"></i>
        <span>From ${delivery.from} to ${delivery.to}</span>
    </div>
    <div class="delivery-info">
        <i class="fas fa-clock"></i>
        <span>${delivery.hours}</span>
    </div>
    <div class="delivery-info">
        <i class="fas fa-money-bill-wave"></i>
        <span>${delivery.price ? delivery.price + '$' : 'Price not specified'}</span>
    </div>
    <div class="mt-2">
        <a href="${whatsappLink}" class="whatsapp-btn" target="_blank">
            <i class="fab fa-whatsapp"></i> Contact via WhatsApp
        </a>
    </div>
`;
                col.appendChild(card);
                container.appendChild(col);
            });
        }

        // Load user messages
        function loadUserMessages() {
            if (!currentUser) return;
            
            db.collection('supportMessages')
                .where('userId', '==', currentUser.uid)
                .orderBy('createdAt', 'desc')
                .get()
                .then(snapshot => {
                    const messagesContainer = document.getElementById('messagesList');
                    messagesContainer.innerHTML = '';
                    
                    if (snapshot.empty) {
                        messagesContainer.innerHTML = `
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>You haven't sent any messages to support yet
                            </div>
                        `;
                        return;
                    }
                    
                    const messagesHeader = document.createElement('h5');
                    messagesHeader.className = 'mt-4';
                    messagesHeader.innerHTML = '<i class="fas fa-envelope me-2"></i>Your Messages';
                    messagesContainer.appendChild(messagesHeader);
                    
                    snapshot.forEach(doc => {
                        const message = doc.data();
                        const messageCard = document.createElement('div');
                        messageCard.className = 'message-card mb-3';
                        
                        messageCard.innerHTML = `
                            <div class="message-header">
                                <div class="message-sender">Subject: ${message.subject}</div>
                                <div class="message-date">${message.createdAt.toDate().toLocaleString()}</div>
                                <button class="btn btn-sm btn-danger delete-message-btn" data-id="${doc.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <div class="message-content">
                                <p>${message.message}</p>
                            </div>
                            <div class="message-status">
                                Status: ${message.status === 'unread' ? 
                                    '<span class="badge bg-warning">Unread</span>' : 
                                    '<span class="badge bg-success">Read</span>'}
                            </div>
                            ${(message.replies && message.replies.length > 0) ? `
                                <div class="message-replies mt-2">
                                    <h6><i class="fas fa-reply me-2"></i>Replies (${message.replies.length})</h6>
                                    ${message.replies.map(reply => `
                                        <div class="reply-card p-2 mt-2 bg-light rounded">
                                            <div class="reply-date small text-muted">
                                                ${reply.createdAt.toDate().toLocaleString()}
                                            </div>
                                            <div class="reply-message">
                                                ${reply.message}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        `;
                        
                        messagesContainer.appendChild(messageCard);
                    });
                    
                    // Add event listeners to delete buttons
                    document.querySelectorAll('.delete-message-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const messageId = btn.getAttribute('data-id');
                            if (confirm('Are you sure you want to delete this message?')) {
                                db.collection('supportMessages').doc(messageId).delete()
                                    .then(() => {
                                        loadUserMessages();
                                        showStatus('Message deleted', 'success');
                                    })
                                    .catch(error => {
                                        showStatus('Error deleting message: ' + error.message, 'error');
                                    });
                            }
                        });
                    });
                });
        }

        // Show shop details modal
        function showShopDetails(shop) {
            if (!currentUser) {
                loginRequiredModal.show();
                return;
            }
            
            // Create modal content
            const modalContent = `
                <div class="modal-header">
                    <h5 class="modal-title">${shop.name}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <img src="${shop.imageUrl}" class="img-fluid rounded mb-3" alt="${shop.name}">
                    <div class="mb-3">
                        <h6>Shop Details</h6>
                        <p><i class="fas fa-info-circle me-2"></i> ${shop.description}</p>
                        <p><i class="fas fa-map-marker-alt me-2"></i> Location: ${shop.location}</p>
                        <p><i class="fas fa-tag me-2"></i> Category: ${shop.category}</p>
                        ${shop.hasDelivery ? '<p><i class="fas fa-truck me-2"></i> Delivery available</p>' : ''}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="enterShopBtn" data-id="${shop.id}">
                        <i class="fas fa-store me-2"></i> Enter Shop
                    </button>
                </div>
            `;
            
            // Create modal dynamically
            const modalDiv = document.createElement('div');
            modalDiv.className = 'modal fade';
            modalDiv.id = 'shopDetailsModal';
            modalDiv.tabIndex = '-1';
            modalDiv.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content">
                        ${modalContent}
                    </div>
                </div>
            `;
            
            // Add modal to body
            document.body.appendChild(modalDiv);
            
            // Initialize modal
            const modal = new bootstrap.Modal(modalDiv);
            modal.show();
            
            // Add event listener for enter shop button
            document.getElementById('enterShopBtn').addEventListener('click', () => {
                window.location.href = `${shop.id}.html`;
            });
            
            // Remove modal when hidden
            modalDiv.addEventListener('hidden.bs.modal', () => {
                document.body.removeChild(modalDiv);
            });
        }

        // Load account info
        function loadAccountInfo() {
            if (!currentUser) {
                accountNotLoggedIn.style.display = 'block';
                accountLoggedIn.style.display = 'none';
                return;
            }
            
            accountNotLoggedIn.style.display = 'none';
            accountLoggedIn.style.display = 'block';
            
            // Use display name if available, otherwise use email
            const displayName = currentUserData?.name ;
            document.getElementById('accountName').textContent = displayName;
            document.getElementById('accountEmail').textContent = currentUser.email;
            document.getElementById('accountType').textContent = currentUserData?.isAdmin ? 'Admin' : 'Regular User';
            
            // Format joined date
            const joinedDate = new Date(currentUser.metadata.creationTime);
            document.getElementById('accountJoinedDate').textContent = joinedDate.toLocaleDateString() + ' at ' + joinedDate.toLocaleTimeString();
            
            // Show shop info if user is a shop owner
            if (currentUserData?.shopId) {
                db.collection('shops').doc(currentUserData.shopId).get()
                    .then(doc => {
                        const shop = doc.data();
                        if (shop) {
                            shopOwnerInfo.style.display = 'block';
                            shopNameDisplay.textContent = shop.name;
                            shopExpiryDate.textContent = new Date(shop.expiryDate).toLocaleDateString();
                        }
                    });
            } else {
                shopOwnerInfo.style.display = 'none';
            }
        }

        // Show status message
        function showStatus(message, type = 'info') {
            const statusElement = document.getElementById('statusMessage');
            statusElement.innerHTML = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            `;
            
            // Auto dismiss after 5 seconds
            setTimeout(() => {
                const alert = statusElement.querySelector('.alert');
                if (alert) {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }
            }, 5000);
        }
searchInput.addEventListener('click', () => {
    searchPanel.classList.add('active');
    updateRecentSearches();
    
    // Set appropriate placeholder based on active tab
    if (activeTab === 'home') {
        searchPanelInput.placeholder = 'Search for shops';
    } else if (activeTab === 'delivery') {
        searchPanelInput.placeholder = 'Search for delivery services';
    }
});

// Update the performSearch function to handle delivery searches separately
function performSearch(searchTerm, filters = {}) {
    const container = activeTab === 'home' ? document.getElementById('allShopsContainer') : document.getElementById('deliveryContainer');
    
    // Show skeleton loaders
    container.innerHTML = '';
    for (let i = 0; i < 6; i++) {
        const col = document.createElement('div');
        col.className = activeTab === 'home' ? 'col-md-4 col-6' : 'col-md-6';
        col.innerHTML = `
            <div class="skeleton-loader skeleton-card">
                <div class="skeleton-image"></div>
                <div class="skeleton-content">
                    <div class="skeleton-text"></div>
                    <div class="skeleton-text short"></div>
                    ${activeTab === 'delivery' ? '<div class="skeleton-text short"></div><div class="skeleton-text short"></div>' : ''}
                </div>
            </div>
        `;
        container.appendChild(col);
    }
    
    if (activeTab === 'home') {
        // Search shops (only in name and description)
        let query = db.collection('shops').where('isPublic', '==', true);
        
        query.get().then(snapshot => {
            const filteredShops = [];
            
            snapshot.forEach(doc => {
                const shop = doc.data();
                shop.id = doc.id;
                
                // Check if matches search term in name or description
                const matchesSearch = shop.name.toLowerCase().includes(searchTerm) || 
                                     shop.description.toLowerCase().includes(searchTerm);
                
                // Check filters if provided
                const matchesCategory = !filters.category || shop.category === filters.category;
                const matchesLocation = !filters.location || shop.location === filters.location;
                
                if (matchesSearch && matchesCategory && matchesLocation) {
                    filteredShops.push(shop);
                }
            });
            
            // Hide categories and show all shops container
            categoriesSection.style.display = 'none';
            categoryShopsContainer.style.display = 'none';
            shopsSection.style.display = 'block';
            
            // Display filtered results in all shops container
            displayShops(filteredShops, 'allShopsContainer');
            
            showStatus(`Found ${filteredShops.length} matching shops`, 'info');
        });
    } else if (activeTab === 'delivery') {
        // Search deliveries with all filters
        let query = db.collection('deliveries').where('isPublic', '==', true);
        
        query.get().then(snapshot => {
            const filteredDeliveries = [];
            
            snapshot.forEach(doc => {
                const delivery = doc.data();
                delivery.id = doc.id;
                
                // Check search term in name or description
                const matchesSearch = delivery.name.toLowerCase().includes(searchTerm) || 
                                     (delivery.description && delivery.description.toLowerCase().includes(searchTerm));
                
                // Check location filters
                const matchesFrom = !filters.from || delivery.from === filters.from;
                const matchesTo = !filters.to || delivery.to === filters.to;
                
                // Check price range
                const price = delivery.price || 0;
                const matchesMinPrice = !filters.minPrice || price >= Number(filters.minPrice);
                const matchesMaxPrice = !filters.maxPrice || price <= Number(filters.maxPrice);
                
                if (matchesSearch && matchesFrom && matchesTo && matchesMinPrice && matchesMaxPrice) {
                    filteredDeliveries.push(delivery);
                }
            });
            
            // Display filtered results
            displayDeliveries(filteredDeliveries);
            
            showStatus(`Found ${filteredDeliveries.length} matching delivery services`, 'info');
        });
    }
    
    // Show back to main button in search panel
    searchBackToMainBtn.style.display = 'block';
}

// Update the search panel button click handler
searchPanelBtn.addEventListener('click', () => {
    const searchTerm = searchPanelInput.value.trim().toLowerCase();
    if (searchTerm) {
        // Add to recent searches if not already there
        if (!recentSearches.includes(searchTerm)) {
            recentSearches.unshift(searchTerm);
            if (recentSearches.length > 5) {
                recentSearches.pop();
            }
            localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
            updateRecentSearches();
        }
        
        // Perform search based on active tab
        if (activeTab === 'home') {
            const location = document.getElementById('shopLocationFilter').value;
            performSearch(searchTerm, { location });
        } else if (activeTab === 'delivery') {
            const from = document.getElementById('deliveryFromFilter').value;
            const to = document.getElementById('deliveryToFilter').value;
            performSearch(searchTerm, { from, to });
        }
        
        // Close search panel
        searchPanel.classList.remove('active');
    }
});

     searchBtn.addEventListener('click', () => {
    const searchTerm = searchInput.value.trim().toLowerCase();
    if (searchTerm) {
        // Perform search based on active tab
        if (activeTab === 'home') {
            const location = document.getElementById('shopLocationFilter').value;
            performSearch(searchTerm, { location });
        } else if (activeTab === 'delivery') {
            const from = document.getElementById('deliveryFromFilter').value;
            const to = document.getElementById('deliveryToFilter').value;
            performSearch(searchTerm, { from, to });
        }
    } else {
        // If search term is empty, just show all items
        if (activeTab === 'home') {
            loadCategoryShops();
        } else if (activeTab === 'delivery') {
            loadDeliveries();
        }
    }
});

        searchPanelBackBtn.addEventListener('click', () => {
            searchPanel.classList.remove('active');
        });

        searchPanelBtn.addEventListener('click', () => {
            const searchTerm = searchPanelInput.value.trim().toLowerCase();
            if (searchTerm) {
                // Add to recent searches if not already there
                if (!recentSearches.includes(searchTerm)) {
                    recentSearches.unshift(searchTerm);
                    if (recentSearches.length > 5) {
                        recentSearches.pop();
                    }
                    localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
                    updateRecentSearches();
                }
                
                // Get filters
    
                const locationFilterValue = locationFilter.value;
                
                // Perform search
                searchPanel.classList.remove('active');
                performSearch(searchTerm, categoryFilterValue, locationFilterValue);
            }
        });

    searchPanelInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        const searchTerm = searchPanelInput.value.trim().toLowerCase();
        if (searchTerm) {
            // Perform search based on active tab
            if (activeTab === 'home') {
                const location = document.getElementById('shopLocationFilter').value;
                performSearch(searchTerm, { location });
            } else if (activeTab === 'delivery') {
                const from = document.getElementById('deliveryFromFilter').value;
                const to = document.getElementById('deliveryToFilter').value;
                performSearch(searchTerm, { from, to });
            }
            
            // Close search panel
            searchPanel.classList.remove('active');
        }
    }
});

        // Back to main button in search panel
        searchBackToMainBtn.addEventListener('click', () => {
            searchPanel.classList.remove('active');
            if (activeTab === 'home') {
                loadCategoryShops();
            } else if (activeTab === 'delivery') {
                loadDeliveries();
            }
        });

        // Update recent searches display
        function updateRecentSearches() {
            recentSearchesContainer.innerHTML = '';
            
            if (recentSearches.length === 0) {
                recentSearchesContainer.innerHTML = '<div class="text-muted">No recent searches</div>';
                return;
            }
            
            recentSearches.forEach(search => {
                const searchItem = document.createElement('div');
                searchItem.className = 'search-item';
                searchItem.innerHTML = `
                    <span>${search}</span>
                    <span class="search-item-remove" data-search="${search}">
                        <i class="fas fa-times"></i>
                    </span>
                `;
                recentSearchesContainer.appendChild(searchItem);
                
                // Add click handler to search item
                searchItem.querySelector('span:first-child').addEventListener('click', () => {
                    searchPanelInput.value = search;
                    searchPanelBtn.click();
                });
                
                // Add click handler to remove button
                searchItem.querySelector('.search-item-remove').addEventListener('click', (e) => {
                    e.stopPropagation();
                    const searchToRemove = e.currentTarget.getAttribute('data-search');
                    recentSearches = recentSearches.filter(s => s !== searchToRemove);
                    localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
                    updateRecentSearches();
                });
            });
        }

        // Support panel functionality
        supportBtn.addEventListener('click', () => {
            if (!currentUser) {
                loginRequiredModal.show();
                return;
            }
            supportPanel.classList.add('active');
            loadUserMessages();
        });

        supportPanelBackBtn.addEventListener('click', () => {
            supportPanel.classList.remove('active');
        });

        // Favorite shops panel functionality
        favoriteShopsBtn.addEventListener('click', () => {
            if (!currentUser) {
                loginRequiredModal.show();
                return;
            }
            favoritePanel.classList.add('active');
            loadFavoriteShopsPanel();
        });

        favoritePanelBackBtn.addEventListener('click', () => {
            favoritePanel.classList.remove('active');
        });

        // Update auth buttons in navbar
        function updateAuthButtons() {
            if (currentUser) {
                authButtons.innerHTML = `
                    <span class="text-white me-2 d-none d-sm-inline">${currentUser.email}</span>
                `;
            } else {
                authButtons.innerHTML = `
                    <a href="login.html" class="login-btn me-2">
                        <i class="fas fa-sign-in-alt me-1"></i> Login
                    </a>
                    <a href="signup.html" class="btn btn-outline-light">
                        <i class="fas fa-user-plus me-1"></i> Sign Up
                    </a>
                `;
            }
        }

        // Check authentication state
        function checkAuthState() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    
                    // Load user data from database
                    db.collection('users').doc(user.uid).get()
                        .then(doc => {
                            currentUserData = doc.exists ? doc.data() : {};
                            
                            // Initialize favoriteShops array if it doesn't exist
                            if (!currentUserData.favoriteShops) {
                                currentUserData.favoriteShops = [];
                            }
                            
                            // Update logout button text in dropdown
                            logoutBtn.innerHTML = `<i class="fas fa-sign-out-alt me-2"></i>Logout (${currentUser.email})`;
                        });
                } else {
                    // User is not logged in
                    currentUser = null;
                    currentUserData = null;
                    logoutBtn.innerHTML = `<i class="fas fa-sign-out-alt me-2"></i>Logout`;
                }
                
                // Always update account info display
                loadAccountInfo();
                loadNotifications();
                updateAuthButtons();
            });
        }

        // Initialize the app
        window.addEventListener('DOMContentLoaded', () => {
            checkTheme();
            checkLanguage();
            checkAuthState();
            
            // Hide loading screen after 2 seconds
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                loadFeaturedShops();
                loadCategoryShops();
            }, 2000);
            
            // Add event listener for Enter key in search
            searchPanelInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchPanelBtn.click();
                }
            });
        });
    </script>
</body>
</html>